<?php

///////////////////////////////////////////////////
////// Administration für Hauptmodul für die //////
////////// customer-login Funktionalität //////////
///////////////////////////////////////////////////

include(\Util::getDocumentRoot()."system/legacy/admin/includes/main.inc.php");
include(\Util::getDocumentRoot()."system/legacy/admin/extensions/customer_db/customer_db_class.inc.php");

echo Admin_Html::loadAdminHeader();

Access_Backend::checkAccess("modules_admin");

$my_parent = get_data(db_query($db_data['system'],"SELECT * FROM cms_content WHERE page_id = '".$_VARS['page_id']."' AND content LIKE '%<#content".(str_pad($_VARS['element_id'], 3, "0", STR_PAD_LEFT))."#>%'"));
$aParent = new \Cms\Helper\ExtensionConfig($_VARS['page_id'], $_VARS['element_id'], $_VARS['content_id'], $_VARS['language']);

if($_POST['action'] == "config")
{
	$config = new \Cms\Helper\ExtensionConfig($_VARS['page_id'], $_VARS['element_id'], $_VARS['content_id'], $_VARS['language']);

	$config->sendinfo 	            = $_VARS['sendinfo'];
	$config->email_subject 	        = $_VARS['email_subject'];
	$config->email_message 	        = $_VARS['email_message'];

	$config->sendinfo2user 	        = $_VARS['sendinfo2user'];
	$config->email_subject2user 	= $_VARS['email_subject2user'];
	$config->email_message2user 	= $_VARS['email_message2user'];

	$config->msg_activate_success   = $_VARS['msg_activate_success'];
    $config->msg_activate_failed    = $_VARS['msg_activate_failed'];
    $config->msg_deactive_success   = $_VARS['msg_deactive_success'];
    $config->msg_deactivate_failed  = $_VARS['msg_deactivate_failed'];
    $config->msg_failed             = $_VARS['msg_failed'];

	$config->save_config($_VARS['page_id'], $_VARS['element_id'], $_VARS['content_id']);
}

// Laden der vorhandenen Daten
$config = new \Cms\Helper\ExtensionConfig($_VARS['page_id'], $_VARS['element_id'], $_VARS['content_id'], $_VARS['language']);




// Fülle mit Standartvorgaben:
if(!$config->msg_activate_success)
{
	$config->msg_activate_success   = "Aktivierung erfolgreich durchgeführt!";
}

if(!$config->msg_activate_failed)
{
    $config->msg_activate_failed    = "Aktivierung fehlgeschlagen! Bitte prüfen Sie Ihren Aktivierungslink!";
}

if(!$config->msg_deactive_success)
{
    $config->msg_deactive_success   = "Deaktivierung erfolgreich durchgeführt!";
}

if(!$config->msg_deactivate_failed)
{
    $config->msg_deactivate_failed  = "Deaktivierung fehlgeschlagen! Bitte prüfen Sie Ihren Deaktivierungslink!";
}

if(!$config->msg_failed)
{
    $config->msg_failed             = "Keine Statusänderung möglich!";
}







?>

<table cellpadding="0" cellspacing="30" border="0" width="100%" height="100%">
	<tr>
		<td valign="top">
			<h1>Konfiguration Registry-Modul</h1>

			<form name="customer_db_form" method=post enctype="multipart/form-data" action="<?=$_SERVER['PHP_SELF']?>">
			<input type="hidden" name="action" value="config">
			<input type="hidden" name="page_id" value="<?=$_VARS['page_id']?>">
			<input type="hidden" name="element_id" value="<?=$_VARS['element_id']?>">
			<input type="hidden" name="content_id" value="<?=$_VARS['content_id']?>">
			<?=printTableStart()?>

                <?=printFormCheckbox("E-Mail an Admin senden?","sendinfo", 1, $config->sendinfo)?>
				<?=printFormText("Betreff der Bestätigungs-E-Mail","email_subject",$config->email_subject)?>
				<?=printFormTextarea("Inhalt der Bestätigungs-E-Mail (Platzhalter für User-Daten: <#nickname#>, <#email#>)","email_message",$config->email_message)?>


                <?=printFormCheckbox("E-Mail an User senden?","sendinfo2user", 1, $config->sendinfo2user)?>
				<?=printFormText("Betreff der Bestätigungs-E-Mail","email_subject2user",$config->email_subject2user)?>
				<?=printFormTextarea("Inhalt der Bestätigungs-E-Mail (Platzhalter für User-Daten: <#nickname#>, <#email#>)","email_message2user",$config->email_message2user)?>


				<?=printFormTextarea("Meldung: Aktivierung erfolgreich","msg_activate_success",$config->msg_activate_success)?>
				<?=printFormTextarea("Fehlermeldung: Aktivierung fehlgeschlagen","msg_activate_failed",$config->msg_activate_failed)?>
				<?=printFormTextarea("Meldung: Abmeldung erfolgreich","msg_deactive_success",$config->msg_deactive_success)?>
				<?=printFormTextarea("Fehlermeldung: Deaktivierung fehlgeschlagen","msg_deactivate_failed",$config->msg_deactivate_failed)?>
				<?=printFormTextarea("Fehlermeldung: Kein Zugriff","msg_failed",$config->msg_failed)?>

			<?=printTableEnd()?>
			<?=printSubmit("Konfiguration speichern")?>

		</form>
		</td>
	</tr>
</table>

<?=Admin_Html::loadAdminFooter()?>
