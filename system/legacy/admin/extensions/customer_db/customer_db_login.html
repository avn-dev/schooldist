<?

include(\Util::getDocumentRoot()."admin/includes/main.inc.php");

Access_Backend::checkAccess("modules_admin");

///////////////////////////////////////////////////
////// Administration f체r Hauptmodul f체r die //////
////////// customer-login Funktionalit채t //////////
///////////////////////////////////////////////////


require (\Util::getDocumentRoot()."system/legacy/admin/extensions/customer_db/customer_db_class.inc.php");

global $db_data;

$SQL_handler = new customer_db;
$config = new \Cms\Helper\ExtensionConfig($_VARS['page_id'], $_VARS['element_id'], $_VARS['content_id'], $_VARS['language']);




$identifier="customer_db_";
$definition_table=$identifier."definition";
$value_table=$identifier."values";

////////////////////////////////////////////////


if ($form_action=="Speichern"  && $page_id > 0 && $element_id > 0)
{


  $config->table_name 	    = $table_name;
  $config->url              = $url;
  $config->success_msg      = $success_msg;
  $config->fail_msg         = $fail_msg;

  $config->save_config($page_id, $element_id);

}

// Laden der vorhandenen Daten
$config->config_class($page_id, $element_id);


////////////////////////////////////////////////

function show_tables($db_module,$SQL_handler,$identifier,$table_name)
{
    $SQL_handler->SQL_get_table_names($db_module,$identifier);
    $result=$SQL_handler->result[1];

    $option_name[]="db_nr";
    $option_name[]="field_nr";
    $option='';

    for ($i=0;$i<count($result);$i++)
    {
        unset($option);
        $pos=strrpos($result[$i],"_")+1;
        $option[]=substr($result[$i],$pos);
        $option[]=0;

        $SQL_handler->SQL_get_row_by_option($db_module,"customer_db_definition", $table_name, $option_name, $option);
        $name_result=$SQL_handler->result[1];

        $aDBNames[]=$name_result[0]["name"];
    }



  echo "<select name=\"table_name\">";


  for ($i=0;$i<count($result);$i++)
  {
	if ($table_name==$result[$i])
	 {
	  $pre_select="SELECTED";
	 }
 	else
	 {
	   $pre_select="";
	 }
	echo "<option $pre_select value=\"".$result[$i]."\">";
	echo $aDBNames[$i];
	echo "</option>";
  }

  echo"</select>";

  return $result;
} // ende function show_tables

////////////////////////////////////////////////



?>

<?=Admin_Html::loadAdminHeader()?>

<table cellpadding="0" cellspacing="30" border="0" width="100%" height="100%">
<tr>
<td valign="top">
<h1>Konfiguration Login-Hauptmodul</h1>


<form name="customer_db_login_form" method=post enctype="multipart/form-data" action="<?=$PHP_SELF?>">

<input type='hidden' name="page_id" value=<?=$page_id?>>
<input type='hidden' name="element_id" value=<?=$element_id?>>
<input type='hidden' name="form_action" value="Speichern">



<table class=table border=0 cellpadding="4" cellspacing=0 >


				<tr ><td>Bitte Datenbank ausw채hlen :
                                <? show_tables($db_data['module'],$SQL_handler,$identifier,$config->table_name);?>




</td>
<td>
</tr>

				<tr class=head><td>Wohin soll der Kunde nach dem Login gelangen?</td></tr>
				<tr class=first><td>
					<table width='100%' align=center cellspacing="2" cellpadding="2" border="0" >
                                                <colgroup>
                                                   <col width="20">
                                                   <col width="100">
                                                   <col width="10">
                                                   <col width="*">
                                                   <col width="20">
                                                </colgroup>
                                                <tr>
                                                   <td></td>
                                                   <td>Seite: </td>
                                                   <td></td>
                                                   <td><?=printPageSelect("url",$config->url); ?></td>
                                                   <td></td>
						</tr>
					</table>
					</td>
				</tr>
				<tr class=head><td>Welche Meldungen soll der Kunde bekommen?</td></tr>
				<tr class=first><td>
					<table width='100%' align=center cellspacing="2" cellpadding="2" border="0" >
                                                <colgroup>
                                                   <col width="20">
                                                   <col width="100">
                                                   <col width="10">
                                                   <col width="*">
                                                   <col width="20">
                                                </colgroup>
                                                <tr>
                                                   <td></td>
                                                   <td>Bei Erfolg: </td>
                                                   <td></td>
                                                   <td><textarea name="success_msg" style= 'width:400px'><?=stripslashes($config->success_msg)?></textarea></td>
                                                   <td></td>
						</tr>
                                                <tr>
                                                   <td></td>
                                                   <td>Bei Misserfolg: </td>
                                                   <td></td>
                                                   <td><textarea name="fail_msg" style= 'width:400px'><?=stripslashes($config->fail_msg)?></textarea></td>
                                                   <td></td>
						</tr>
						
						<tr>
						<td align=center colspan=4>
                                                <input class=btn type=button name="form_action" value="Speichern" OnClick='document.customer_db_login_form.form_action.value="Speichern";document.customer_db_login_form.submit();'>
                                                <input class=btn type=button value="Fenster schliessen" OnClick='top.close();'>
                                                </td>
						</tr>
						
						
					</table>
					</td>
				</tr>



</table>

<?=Admin_Html::loadAdminFooter()?>
