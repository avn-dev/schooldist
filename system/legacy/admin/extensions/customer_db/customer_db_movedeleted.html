<?php

///////////////////////////////////////////////////
////// Administration f�r Hauptmodul für die //////
////////// customer-login Funktionalität //////////
///////////////////////////////////////////////////

include(\Util::getDocumentRoot()."system/legacy/admin/includes/main.inc.php");

Access_Backend::checkAccess("modules_admin");

include(\Util::getDocumentRoot()."system/legacy/admin/extensions/customer_db/customer_db_class.inc.php");

echo Admin_Html::loadAdminHeader();

$my_parent = get_data(db_query($db_data['system'],"SELECT * FROM cms_content WHERE page_id = '".$_VARS['page_id']."' AND content LIKE '%<#content".(str_pad($_VARS['element_id'], 3, "0", STR_PAD_LEFT))."#>%'"));
$aParent = new \Cms\Helper\ExtensionConfig($_VARS['page_id'], $_VARS['element_id'], $_VARS['content_id'], $_VARS['language']);

if($_POST['action'] == "config")
{
	$config = new \Cms\Helper\ExtensionConfig($_VARS['page_id'], $_VARS['element_id'], $_VARS['content_id'], $_VARS['language']);

	$config->destination_table 	            = $_VARS['destination_table'];

    $config->email_message 	= $_VARS['email_message'];
	$config->email_subject 	= $_VARS['email_subject'];

    $config->save_config($_VARS['page_id'], $_VARS['element_id'], $_VARS['content_id']);
}

// Laden der vorhandenen Daten
$config = new \Cms\Helper\ExtensionConfig($_VARS['page_id'], $_VARS['element_id'], $_VARS['content_id'], $_VARS['language']);

#var_dump($_REQUEST);
#echo "<br />";
#var_dump($config);



$table_selection = "<select name=destination_table>";

$query="SELECT id,db_name FROM customer_db_config WHERE active=1";
$result=db_query($query);

while($my=get_data($result))
{
    #echo"<br />";
    #var_dump($my);

    if(intval($my['id'])==intval($config->destination_table))
    {
        $SELECTED="SELECTED";
    }
    else
    {
        $SELECTED='';
    }

    $table_selection.= "<option value=".$my['id']." $SELECTED>".$my['db_name']."</option>";
}


$table_selection.= "</select>";

?>

<table cellpadding="0" cellspacing="30" border="0" width="100%" height="100%">
	<tr>
		<td valign="top">
			<h1>Konfiguration MoveDeleted-Modul</h1>

			<form name="customer_db_form" method=post enctype="multipart/form-data" action="<?=$_SERVER['PHP_SELF']?>">
			<input type="hidden" name="action" value="config">
			<input type="hidden" name="page_id" value="<?=$_VARS['page_id']?>">
			<input type="hidden" name="element_id" value="<?=$_VARS['element_id']?>">
			<input type="hidden" name="content_id" value="<?=$_VARS['content_id']?>">
			<?=printTableStart()?>

                    <th>Zieltabelle</th>
                    <td>
    				<?=$table_selection?>
                    </td>

    				<?=printFormText("Betreff der Bestätigungs-E-Mail","email_subject",$config->email_subject)?>
    				<?=printFormTextarea("Inhalt der Bestätigungs-E-Mail (Platzhalter: <#nickname#>, <#email#>, <#password#>; zusätzlich können alle weiteren Felder mit <#ext_NUMMER#> ausgegeben werden)","email_message",$config->email_message)?>



			<?=printTableEnd()?>
			<?=printSubmit("Konfiguration speichern")?>

		</form>
		</td>
	</tr>
</table>

<?=Admin_Html::loadAdminFooter()?>
