<?php

/*
 * Created on 13.10.2006
 *
 * To change the template for this generated file go to
 * Window - Preferences - PHPeclipse - PHP - Code Templates
 */
///////////////////////////////////////////////////
//////// Administration für customer_db_quit    ////////
///////////////////////////////////////////////////

include(\Util::getDocumentRoot()."system/legacy/admin/includes/main.inc.php");

Access_Backend::checkAccess("modules_admin");

include(\Util::getDocumentRoot()."system/legacy/admin/extensions/customer_db/customer_db_class.inc.php");

echo Admin_Html::loadAdminHeader();

var_dump($_VARS);

if($_REQUEST['form_action'] == "config") {
	$config = new \Cms\Helper\ExtensionConfig($_VARS['page_id'], $_VARS['element_id'], $_VARS['content_id'], $_VARS['language']);

	$config->body 					= $_VARS['body'];
	$config->subject 				= $_VARS['subject'];	
	$config->email_link_destination	= $_VARS['email_link_destination'];	
	$config->from 					= $_VARS['from'];	
	$config->config_sent 			= $_VARS['config_sent'];	
	#$config->subject 		= $_VARS['subject'];	



	$config->save_config($_VARS['page_id'], $_VARS['element_id'], $_VARS['content_id']);
}

// Laden der vorhandenen Daten
$config = new \Cms\Helper\ExtensionConfig($_VARS['page_id'], $_VARS['element_id'], $_VARS['content_id'], $_VARS['language']);


$Mailtext="Mailtext<br>folgende Parameter können benutzt werden: <#email#>,<#nickname#>,<#link#> und ausserdem alle Datenbankfelder mittels <#ext_NUMMER#>";

if(!$config->body) $config->body="Für Ihre Emailadresse ist eine Beendigung des Newsletter Abos gewählt worden. \n" .
		"Um dieses Abo endgültig zu beenden klicken Sie einfach den unten stehenden Link. \n" .
		"Sollten Sie das Abo gar nicht kündigen wollen, so brauchen Sie nichts weiter zu unternehmen.\n" .
		"<#link#>";

if(!$config->from) $config->from="\"Administrator\" <".\System::d('admin_email').">";

if(!$config->config_sent) $config->config_sent="Um endgültig zu kündigen, bestätigen Sie bitte die Email";

?>

<table cellpadding="0" cellspacing="30" border="0" width="100%" height="100%">
	<tr>
		<td valign="top">
			<h1>Konfiguration Kündigung</h1>

			<form name="customer_db_form" method=post enctype="multipart/form-data" action="<?=$_SERVER['PHP_SELF']?>">
			<input type=hidden name="form_action" value="config">
			<?=printTableStart()?>
			<?=printFormText("Absender","from",$config->from)?>
			<?=printFormText("Betreff","subject",$config->subject)?>
			<?=printFormTextarea("$Mailtext","body",$config->body)?>
			
            <th>Zielseite für Deaktiverungslink</th>
            <td>
			<?=printPageSelect("email_link_destination",$config->email_link_destination,"","","width:400px");?>
            </td>
			
			<?=printFormHTMLarea("Message: Erfolg","config_sent",$config->config_sent)?>
			
			<?=printTableEnd()?>

			<?=printSubmit("Konfiguration speichern")?>

		</form>
		</td>
	</tr>
</table>


?>
