<?php

include("../includes/main.inc.php");

Access_Backend::checkAccess("modules_admin");

include_once("./form.inc.html");

?>

<?=Admin_Html::loadAdminHeader()?>

<style>
	body {
		background: #ffffff!important;
	}
.newfolder {
	border-bottom: 1px solid black;
	border-right: 1px solid black;
	border-top: 1px solid black;
	border-left: 1px solid black;
}
.select_on {
	background-color: buttonface;
	border-bottom: 1px solid buttonhighlight;
	border-right: 1px solid buttonhighlight;
	border-top: 1px solid buttonshadow;
	border-left: 1px solid buttonshadow;
}
.select_off {
	background-color: buttonface;
	border-top: 1px solid buttonhighlight;
	border-left: 1px solid buttonhighlight;
	border-bottom: 1px solid buttonshadow;
	border-right: 1px solid buttonshadow;
}
</style>
<script>

var folder = "<?php echo $folder; ?>";
/**
 * Sets/unsets the pointer in browse mode
 *
 * @param   object   the table row
 * @param   object   the color to use for this row
 * @param   object   the background color
 *
 * @return  boolean  whether pointer is set or not
 */
var delete_media = new Array();
 
function setPointer(theRow, thePointerColor, theNormalBgColor)
{

	for (var i=0;i<document.getElementsByTagName("tr").length;i++) {
		var a = eval("document.getElementsByTagName('tr')["+i+"];");
			if(a.id != "") {
////////////////////////////////////////////////////////////////////////////////////////
    var theCells = null;

    if (thePointerColor == '' || typeof(a.style) == 'undefined') {
        return false;
    }
    if (typeof(document.getElementsByTagName) != 'undefined') {
        theCells = a.getElementsByTagName('td');
    }
    else if (typeof(theRow.cells) != 'undefined') {
        theCells = a.cells;
    }
    else {
        return false;
    }
    var rowCellsCnt  = theCells.length;
    var currentColor = null;
    var newColor     = null;
	var newTextColor = '#AAAAAA';
    // Opera does not return valid values with "getAttribute"
		currentColor = theCells[0].style.backgroundColor;
        newColor     = theNormalBgColor;
        newTextColor = '#AAAAAA';
        delete_media[a.id] = '0';
        //delete_media[theRow.id] = (currentColor.toLowerCase() == thePointerColor.toLowerCase())

		
        for (var c = 0; c < rowCellsCnt; c++) {
			theCells[c].style.backgroundColor = newColor;
			theCells[c].style.color = newTextColor;
        } // end for
////////////////////////////////////////////////////////////////////////////////////////		
}

}
    var theCells = null;

    if (thePointerColor == '' || typeof(theRow.style) == 'undefined') {
        return false;
    }
    if (typeof(document.getElementsByTagName) != 'undefined') {
        theCells = theRow.getElementsByTagName('td');
    }
    else if (typeof(theRow.cells) != 'undefined') {
        theCells = theRow.cells;
    }
    else {
        return false;
    }
    var rowCellsCnt  = theCells.length;
    var currentColor = null;
    var newColor     = null;
	var newTextColor = '#000000';
    // Opera does not return valid values with "getAttribute"
		currentColor = theCells[0].style.backgroundColor;
        newColor     = (currentColor.toLowerCase() == thePointerColor.toLowerCase())
                     ? theNormalBgColor
                     : thePointerColor;
        newTextColor     = (currentColor.toLowerCase() == thePointerColor.toLowerCase())
                     ? '#AAAAAA'
                     : '#000000';
        delete_media[theRow.id] = (currentColor.toLowerCase() == thePointerColor.toLowerCase())
                     ? 0
                     : 1;
        for (var c = 0; c < rowCellsCnt; c++) {
			theCells[c].style.backgroundColor = newColor;
			theCells[c].style.color = newTextColor;
        } // end for

    return true;
} // end of the 'setPointer()' function

function upd_form_data(id){
	parent.document.form_form_1.id.value = id;
}

</script>



<table cellpadding="1" cellspacing="0" border="0" width="100%" style="table-layout : fixed;">
<tr style="cursor:pointer;">
<td width=5% class=select_off>ID</td>
<td width=35% class=select_off>Betreff</td>
<td width=10% class=select_off>Neu</td>
<td width=10% class=select_off>Bearbeitet</td>
<td width=10% class=select_off>Total</td>
<td width=30% class=select_off>E-Mail</td>
</tr>
<?php

$sSql = "
	SELECT 
		`i`.* 
	FROM 
		`form_init` `i` 
	WHERE 
		1 
	GROUP BY 
		`i`.`id` 
	ORDER BY 
		`i`.`subject`
";
$aForms = DB::getQueryRows($sSql);

foreach($aForms as $iForm=>$arrForm) {

	// Pr체fen, ob ein Recht existiert. Wenn ja, pr체fen, ob es vergeben wurde
	$bInsertEntry = TRUE;
	if(isRight('form_'.$arrForm['id'])) {
		if(
			!hasRight('form_'.$arrForm['id']) &&
			!hasRight('admin')
		) {
			$bInsertEntry = FALSE;
		}
	}

	// Wenn der Eintrag hinzugef체gt werden soll
	if ($bInsertEntry) {
		$intTotal = DB::getQueryOne("SELECT COUNT(*) FROM `form_data_".(int)$arrForm['id']."`");
		$intNew = DB::getQueryOne("SELECT COUNT(*) FROM `form_data_".(int)$arrForm['id']."` WHERE `done` = 0");
		//Listeneintr채ge erzeugen
		echo "<tr style=\"cursor:default;\" id=\"".$arrForm['id']."\" onclick=\"setPointer(this, 'ACTIVECAPTION', '#FFFFFF'); upd_form_data('".$arrForm['id']."');\">";
		echo "<td nowrap align=right>".$arrForm['id']."&nbsp;</td>";
		echo "<td nowrap>".$arrForm['subject']."</td>";
		echo "<td nowrap align=right>".(int)$intNew."&nbsp;</td>";
		echo "<td nowrap align=right>".(int)($intTotal-$intNew)."&nbsp;</td>";
		echo "<td nowrap align=right>".(int)$intTotal."&nbsp;</td>";
		echo "<td nowrap>".$arrForm['email']."</td>";
		echo "</tr>";
	}

}

?>
</tr></table>
<?=Admin_Html::loadAdminFooter()?>
