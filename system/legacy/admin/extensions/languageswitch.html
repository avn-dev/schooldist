<?

include("../includes/main.inc.php");

?>

<?=Admin_Html::loadAdminHeader()?>

<?

if($_POST['action'] == "config") {
	$config = new \Cms\Helper\ExtensionConfig($_VARS['page_id'], $_VARS['element_id'], $_VARS['content_id'], $_VARS['language']);

	$config->defaultlanguage = $_VARS['defaultlanguage'];
	$config->target = $_VARS['target'];

	$config->save_config($_VARS['page_id'], $_VARS['element_id'], $_VARS['content_id']);
}

?>

<table cellpadding="0" cellspacing="30" border="0" width="100%">
	<tr>
		<td valign="top">
			<h1>Sprachauswahl</h1>
			<p>
<?

$config = new \Cms\Helper\ExtensionConfig($_VARS['page_id'], $_VARS['element_id'], $_VARS['content_id'], $_VARS['language']);

$objWebDynamicsDAO = new \Cms\Helper\Data();
$arrPageData = $objWebDynamicsDAO->getPageData($_VARS['page_id']);

$aLanguages = array();
$oSite = Site::getInstance($arrPageData['site_id']);
$aItems = $oSite->getLanguages();
foreach((array)$aItems as $aData) {
	$aLanguages[$aData['code']] = $aData['name'];
}

if($_VARS['page_id'] && $_VARS['element_id'] && $_VARS['content_id']) {

?>
			<form method="POST" name="f1" action="<?=$_SERVER['PHP_SELF']?>">
			<input type="hidden" name="action" value="config" />
			<input type="hidden" name="page_id" value="<?=$_VARS['page_id']?>" />
			<input type="hidden" name="element_id" value="<?=$_VARS['element_id']?>" />
			<input type="hidden" name="content_id" value="<?=$_VARS['content_id']?>" />
			<?=printTableStart()?>
			<?=printFormSelect("Standardsprache", "defaultlanguage", $aLanguages, $config->defaultlanguage)?>

<?

			foreach((array)$aLanguages as $sCode=>$sLanguage) {

				$arrOptions = array();
				$arrOptions['empty']	= array("0"=>"keine Weiterleitung");
				$arrOptions['language']	= $sCode;
				$arrOptions['site_id']	= $arrPageData['site_id'];
				$arrOptions['value_type']	= 1;

?>
			<?=printFormPageSelect("Zielseite ".$sLanguage."", "target[".$sCode."]", $config->target[$sCode], $arrOptions)?>
<?
			}
?>

			<?=printTableEnd()?>
			<?=printSubmit("Konfiguration speichern")?>
			</form>
<?
}
?>
		</td>
	</tr>
</table>
<?=Admin_Html::loadAdminFooter()?>