<?


include("../includes/main.inc.php");

Access_Backend::checkAccess("modules_admin");

?>

<?=Admin_Html::loadAdminHeader()?>

<?
//aktivieren/deaktivieren bearbeiten
if($newsletter_active_id > 0){
	$newsletter_aufgabe = (db_query($db_module, "UPDATE newsletter_recipients SET active = '".$newsletter_active."' WHERE id = '".$newsletter_active_id."'"));
}//if

//Einträge löschen
if($newsletter_loesch_id){
//id's extrahieren
$newsletter_loesch_id = explode("|",$newsletter_loesch_id);
	for($i=0;$i<=count($newsletter_loesch_id);$i++) {
		if($newsletter_loesch_id[$i] > 0) {
			$newsletter_aufgabe = (db_query($db_module, "DELETE FROM newsletter_recipients WHERE id = '$newsletter_loesch_id[$i]'"));
		}//if
	}//for
}//if

	$rNewsletter = (db_query($db_module, "SELECT * FROM newsletter_init WHERE id = '".$_VARS['newsletter_id']."'"));
	$aNewsletter = get_data($rNewsletter);

?>
<style>
.newfolder {
	border-bottom: 1px solid black;
	border-right: 1px solid black;
	border-top: 1px solid black;
	border-left: 1px solid black;
}
.select_on {
	background-color: buttonface;
	border-bottom: 1px solid buttonhighlight;
	border-right: 1px solid buttonhighlight;
	border-top: 1px solid buttonshadow;
	border-left: 1px solid buttonshadow;
}
.select_off {
	background-color: buttonface;
	border-top: 1px solid buttonhighlight;
	border-left: 1px solid buttonhighlight;
	border-bottom: 1px solid buttonshadow;
	border-right: 1px solid buttonshadow;
}
</style>
<script>

var folder = "<? echo $folder; ?>";
/**
 * Sets/unsets the pointer in browse mode
 *
 * @param   object   the table row
 * @param   object   the color to use for this row
 * @param   object   the background color
 *
 * @return  boolean  whether pointer is set or not
 */
var delete_media = new Array();
 
function setPointer(theRow, thePointerColor, theNormalBgColor)
{
if(!window.event.ctrlKey) {

for (var i=0;i<document.getElementsByTagName("tr").length;i++) {
var a = eval("document.getElementsByTagName('tr')["+i+"];");
if(a.id != "") {
////////////////////////////////////////////////////////////////////////////////////////
    var theCells = null;

    if (thePointerColor == '' || typeof(a.style) == 'undefined') {
        return false;
    }
    if (typeof(document.getElementsByTagName) != 'undefined') {
        theCells = a.getElementsByTagName('td');
    }
    else if (typeof(theRow.cells) != 'undefined') {
        theCells = a.cells;
    }
    else {
        return false;
    }
    var rowCellsCnt  = theCells.length;
    var currentColor = null;
    var newColor     = null;
	var newTextColor = 'HIGHLIGHTTEXT';
    // Opera does not return valid values with "getAttribute"
		currentColor = theCells[0].getAttribute('bgcolor');
        newColor     = theNormalBgColor;
        newTextColor = 'INFOTEXT';
        delete_media[a.id] = '0';
        //delete_media[theRow.id] = (currentColor.toLowerCase() == thePointerColor.toLowerCase())

		
        for (var c = 0; c < rowCellsCnt; c++) {
            theCells[c].setAttribute('bgcolor', newColor, 0);
			theCells[c].style.color = newTextColor;
        } // end for
////////////////////////////////////////////////////////////////////////////////////////		
}
}
}// end if not ctrl-key
    var theCells = null;

    if (thePointerColor == '' || typeof(theRow.style) == 'undefined') {
        return false;
    }
    if (typeof(document.getElementsByTagName) != 'undefined') {
        theCells = theRow.getElementsByTagName('td');
    }
    else if (typeof(theRow.cells) != 'undefined') {
        theCells = theRow.cells;
    }
    else {
        return false;
    }
    var rowCellsCnt  = theCells.length;
    var currentColor = null;
    var newColor     = null;
	var newTextColor = 'HIGHLIGHTTEXT';
    // Opera does not return valid values with "getAttribute"
		currentColor = theCells[0].getAttribute('bgcolor');
        newColor     = (currentColor.toLowerCase() == thePointerColor.toLowerCase())
                     ? theNormalBgColor
                     : thePointerColor;
        newTextColor     = (currentColor.toLowerCase() == thePointerColor.toLowerCase())
                     ? 'INFOTEXT'
                     : 'HIGHLIGHTTEXT';
        delete_media[theRow.id] = (currentColor.toLowerCase() == thePointerColor.toLowerCase())
                     ? 0
                     : 1;
        for (var c = 0; c < rowCellsCnt; c++) {
            theCells[c].setAttribute('bgcolor', newColor, 0);
			theCells[c].style.color = newTextColor;
        } // end for

    return true;
} // end of the 'setPointer()' function



function upd_file_prefs(entry_id){
top.frames[0].document.newsletter_newsletter_1.entry_id.value = entry_id;
}

function deleteitem() {
	 var count = 0;
	 var loeschen = "|";
	 for(i=0;i<=delete_media.length;i++) {
	 if(delete_media[i] == 1) {
	 count++;
	 loeschen +=  i + "|";
	 }
	 }
	 if(count>1) {
	 var text = "Möchten Sie diese " + count + " Empfänger wirklich entfernen?";
	  var check = confirm(text);
	 } 
	if(count==1) {
	 var text = "Möchten Sie diesen Empfänger wirklich entfernen?";
	  var check = confirm(text);
	 }
	 if(count==0) {
	 var text = "Es ist kein Empfänger markiert!";
	alert(text);
	 }  
	if(check) {
		document.location.href='<?=$_SERVER['PHP_SELF']?>?newsletter_id=<?=$_VARS['newsletter_id']?>&newsletter_loesch_id=' + loeschen;
	}
}

function upd_newsletter_data(entry_id){
	parent.document.newsletter_newsletter_1.entry_id.value = entry_id;
}
</script>
<script for="document" event="onkeydown()" language="JScript" type="text/jscript">
<!--
 {
 if(window.event.keyCode == "46") {
deleteitem();
  }
 }
//-->
</script>
<script>

var loading;
var imagetypes = "jpg|png|gif|tif|bmp";

</script>

<table cellpadding="1" cellspacing="0" border="0" width="100%" style="table-layout : fixed;">
	<tr style="cursor:pointer;">
		<td width=30% class=select_off>Name</td>
		<td width=30% class=select_off>Vorname</td>
		<td width=30% class=select_off>E-Mail</td>
		<td width=10% class=select_off>Aktiv</td>		
	</tr>
<?

//Daten holen
$rRecipients = (db_query($db_module, "SELECT * FROM newsletter_recipients WHERE newsletter_id = '".$_VARS['newsletter_id']."' ORDER BY name"));
while($aRecipients = get_data($rRecipients)) {

//Grafik und Link für active/deactive
if($aRecipients['active'] == 1){
	$newsletter_active_gra = "sitemap_active.gif";
	$newsletter_active_link = $_SERVER['PHP_SELF']."?newsletter_id=".$_VARS['newsletter_id']."&newsletter_active_id=".$aRecipients['id']."&newsletter_active=0";
}else{
	$newsletter_active_gra = "sitemap_inactive.gif";
	$newsletter_active_link = $_SERVER['PHP_SELF']."?newsletter_id=".$_VARS['newsletter_id']."&newsletter_active_id=".$aRecipients['id']."&newsletter_active=1";
}//else

//Listeneinträge erzeugen
echo "<tr style=\"cursor:default;\" id=\"".$aRecipients['id']."\" onclick=\"setPointer(this, 'ACTIVECAPTION', '#FFFFFF'); upd_newsletter_data('".$aRecipients['id']."');\">";
echo "<td nowrap>".$aRecipients['name']."</td>";
echo "<td nowrap>".$aRecipients['firstname']."</td>";
echo "<td nowrap>".$aRecipients['email']."</td>";
echo "<td nowrap align=\"center\"><a href=\"".$newsletter_active_link."\"><img src=\"/admin/media/".$newsletter_active_gra."\" border=0 align=absmiddle></a></td>";

}//while
?>	
</table>
</body>
</html>
