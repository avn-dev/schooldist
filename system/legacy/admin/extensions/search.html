<?php

$_GET['rs'] = 1;
 
include('../includes/main.inc.php');

Access_Backend::checkAccess('modules_admin');

$oCmsHelper = new Cms\Helper\Data();
$system_data['sites'] = (array)$oCmsHelper->getSites();

Admin_Html::loadAdminHeader();

$aSites = [];
foreach($system_data['sites'] as $aSite) {
	$aSites[$aSite['id']] = $aSite['name'];
}

?>

<table cellpadding="0" cellspacing="30" border="0" width="100%">
	<tr>
		<td valign="top">
			<h1>Standardmodule &raquo; Suche</h1>

			<?
			
				if(!empty($_VARS['site_id'])) {
	
					$oSite = \Cms\Entity\Site::getInstance($_VARS['site_id']);
				
					$oSearch = new Ext_Search($oSite);

					if($_VARS['url'] != '') {

						$sPath = str_replace($system_data['domain'], '', $_VARS['url']);

						$oSearch->processIndexing($sPath);
						$oSearch->save();
					}
					if($_VARS['task'] == 'index') {
					
						$oSearch->index();
			?>
					<br /><br />
					<h2>Indizierung abgeschlossen!</h2>
			<? 
					} 
				} else { ?>

				<form name="index" action="<?=$_SERVER['PHP_SELF']?>">
					<div>
						<input type="hidden" name="task" value="index" />
						Welche Domain soll bei der Indizierung inbegriffen werden?
						<br /><br />
						<select class="txt" name="site_id">
							<? foreach($system_data['sites'] as $mValue) { ?>
								<option value="<?=$mValue['id']?>"><?=$mValue['name'] . ' (' . $mValue['domain'] . ')'?></option>
							<? } ?>
							<option value="all">Alle</option>
						</select>
						<input class="btn" type="submit" name="submit" value="Indizierung durchf&uuml;hren" />
					</div>
				</form>

			<? } ?>

			<br /><br />
			<form method="post" action="<?=$_SERVER['PHP_SELF']?>">
				<?=printTableStart()?>
					<?=printFormSelect('Internetauftritt', 'site_id', $aSites, $_VARS['site_id'])?>
					<?=printFormText('URL', 'url', $_VARS['url'])?>
				<?=printTableEnd()?>
				<?=printSubmit('Indizierung fÃ¼r diese URL starten')?>
			</form>

		</td>
	</tr>
</table>

<?=Admin_Html::loadAdminFooter()?>