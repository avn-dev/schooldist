<?php

require_once(Util::getDocumentRoot()."system/legacy/admin/includes/main.inc.php");

if(
	!Ext_TC_Util::isCoreSystem() &&
	!Ext_TC_Util::isDevSystem()
) {
	die('Lizenzverwaltung ist nur auf CORE.Thebing.com zugelassen!');
}

$oGui = new Ext_TC_Gui2(md5('ac_admin_licence'), 'Ext_TC_Licence_Gui2');

$oGui->setWDBasic('Ext_TC_Licence');
$oGui->setTableData('limit', 100);
$oGui->setTableData('orderby', array('description' => 'ASC'));

$oGui->access = 'admin';
$oGui->class_js = 'LicenceGUI';
$oGui->column_sortable = 1;
$oGui->row_sortable = 0;
$oGui->query_id_column = 'id';
$oGui->query_id_alias = '';
$oGui->multiple_selection = 0;

$oGui->include_jquery = true;
$oGui->include_jquery_multiselect = true;

$oData = $oGui->getDataObject();
$oDialogNew = $oData->createDialog(false);
$oDialogEdit = $oData->createDialog(true);

$oBar = $oGui->createBar();
$oBar->width = '100%';
$oFilter = $oBar->createFilter();
$oFilter->db_column = array('id', 'description', 'licence', 'domains');
$oFilter->db_operator = 'LIKE';
$oFilter->id = 'search';
$oFilter->placeholder = $oGui->t('Suche').'…';
$oBar->setElement($oFilter);
$oGui->setBar($oBar);

$oBar = $oGui->createBar();
$oBar->width = '100%';
$oIcon = $oBar->createNewIcon($oGui->t('Neuer Eintrag'), $oDialogNew, $oGui->t('Neuer Eintrag'));
$oBar->setElement($oIcon);
$oIcon = $oBar->createEditIcon($oGui->t('Editieren'), $oDialogEdit, $oGui->t('Editieren'));
$oBar->setElement($oIcon);
$oIcon = $oBar->createDeleteIcon($oGui->t('Löschen'), $oGui->t('Löschen'));
$oBar->setElement($oIcon);
$oGui->setBar($oBar);

$oBar = $oGui->createBar();
$oBar->width = '100%';
$oBar->position = 'top';
$oPagination = $oBar->createPagination(false, true);
$oBar->setElement($oPagination);
$oLoading = $oBar->createLoadingIndicator();
$oBar->setElement($oLoading);
$oGui->setBar($oBar);


$oColumn = $oGui->createColumn();
$oColumn->db_column = 'description';
$oColumn->db_alias = '';
$oColumn->title = $oGui->t('Beschreibung');
$oColumn->width = 300;
$oColumn->width_resize = true;
$oGui->setColumn($oColumn);

$oColumn = $oGui->createColumn();
$oColumn->db_column = 'external_server_url';
$oColumn->db_alias = '';
$oColumn->title = $oGui->t('Externe Server-URL');
$oColumn->width = 250;
$oColumn->width_resize = true;
$oColumn->format = new Ext_TC_Gui2_Format_Url();
$oGui->setColumn($oColumn);

$oColumn = $oGui->createColumn();
$oColumn->db_column = 'licence';
$oColumn->db_alias = '';
$oColumn->title = $oGui->t('Lizenz');
$oColumn->width = 170;
$oColumn->width_resize = true;
$oGui->setColumn($oColumn);

$oColumn = $oGui->createColumn();
$oColumn->db_column = 'last_access';
$oColumn->db_alias = '';
$oColumn->title = $oGui->t('Letzter Zugriff');
$oColumn->width = 170;
$oColumn->width_resize = true;
$oColumn->format = new Ext_Gui2_View_Format_Date_Time();
$oGui->setColumn($oColumn);

$oColumn = $oGui->createColumn();
$oColumn->db_column = 'release';
$oColumn->db_alias = '';
$oColumn->title = $oGui->t('Release');
$oColumn->width = 100;
$oColumn->width_resize = true;
$oColumn->format = new Ext_TC_Licence_Format_Release();
$oGui->setColumn($oColumn);

$oColumn = $oGui->createColumn();
$oColumn->db_column = 'zend_guard';
$oColumn->db_alias = '';
$oColumn->title = $oGui->t('Zend');
$oColumn->format = new Ext_TC_Gui2_Format_YesNo();
$oColumn->width_resize = false;
$oColumn->small = true;
$oGui->setColumn($oColumn);

$oColumn = $oGui->createColumn();
$oColumn->db_column = 'version';
$oColumn->db_alias = '';
$oColumn->title = $oGui->t('Version');
$oColumn->width_resize = false;
$oColumn->small = true;
$oColumn->width	= 65;
$oGui->setColumn($oColumn);

$oColumn = $oGui->createColumn();
$oColumn->db_column = 'php_version';
$oColumn->db_alias = '';
$oColumn->title = $oGui->t('PHP');
$oColumn->width_resize = false;
$oColumn->small = true;
$oColumn->width	= 65;
$oGui->setColumn($oColumn);

$oColumn = $oGui->createColumn();
$oColumn->db_column = 'school_limit_schools';
$oColumn->db_alias = '';
$oColumn->title = $oGui->t('Limit Schulen');
$oColumn->width_resize = false;
$oColumn->small = true;
$oGui->setColumn($oColumn);

$oColumn = $oGui->createColumn();
$oColumn->db_column = 'school_limit_weeks';
$oColumn->db_alias = '';
$oColumn->title = $oGui->t('Limit Wochen');
$oColumn->width_resize = false;
$oColumn->small = true;
$oGui->setColumn($oColumn);

$oColumn = $oGui->createColumn();
$oColumn->db_column = 'agency_limit_offices';
$oColumn->db_alias = '';
$oColumn->title = $oGui->t('Limit Büros');
$oColumn->width_resize = false;
$oColumn->small = true;
$oGui->setColumn($oColumn);


$oGui->addDefaultColumns();

#$aOptionalInfo = array();
#$aOptionalInfo['js'][] = '/admin/extensions/tc/admin/licence/licence.js';
$oGui->addJs('admin/licence/licence.js', 'tc');
#$oGui->display($aOptionalInfo);
$oGui->display();