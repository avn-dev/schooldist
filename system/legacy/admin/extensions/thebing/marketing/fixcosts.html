<?php

require_once(\Util::getDocumentRoot()."system/legacy/admin/includes/main.inc.php");
Ext_Thebing_Access::accesschecker("thebing_marketing_fixcosts");
$oGui					= new Ext_Thebing_Gui2(md5('thebing_marketing_fixcosts'));
$aOptionalInfo			= array();
$aOptionalInfo['css'][]	= '/assets/ts/css/gui2.css';
$iSessionSchoolId = \Core\Handler\SessionHandler::getInstance()->get('sid');
// Datenbasis
$oGui->setWDBasic('Ext_Thebing_Marketing_Fixcost');
$oGui->setTableData('where', array('idSchool' => $iSessionSchoolId, 'active' => 1));
$oGui->setTableData('limit', 30);
$oGui->setTableData('orderby', array('name' => 'ASC'));

// Listenoptionen
$oGui->column_sortable		= 1;
$oGui->row_sortable			= 0;
$oGui->multiple_selection	= 0;

$oSchool = Ext_Thebing_Client::getFirstSchool();
$aCurrency = $oSchool->getCurrencies();

foreach((array)$aCurrency as $mKey => $aValue){
	$aCurrency_[$aValue['id']] = $aValue['iso4217'] . ' (' . $aValue['sign'] . ')';
}
$aCurrency = $aCurrency_;

// Dialog
$oDialog			= $oGui->createDialog(L10N::t('Fixkosten editieren', $oGui->gui_description).' - {name}', L10N::t('Neue Fixkosten anlegen', $oGui->gui_description));
$oDialog->width		= 900;
$oDialog->height	= 650;

$oDialog->save_as_new_button		= true;
$oDialog->save_bar_options			= true;
$oDialog->save_bar_default_option	= 'new';

$oDialog->setElement($oDialog->createRow(L10N::t('Bezeichnung', $oGui->gui_description), 'input', array('db_alias' => '', 'db_column'=>'name','required' => 1)));
$oDialog->setElement($oDialog->createRow(L10N::t('Währung', $oGui->gui_description), 'select', array('db_alias' => '', 'db_column'=>'currency_id', 'select_options' => $aCurrency)));

// Leiste(n)
$oBar					= $oGui->createBar();
$oBar->width			= '100%';

$oFilter				= $oBar->createFilter();
$oFilter->db_column		= array('id', 'name');
$oFilter->db_alias		= array('', '');
$oFilter->db_operator	= 'LIKE';
$oFilter->id			= 'search';
$oFilter->placeholder	= $oGui->t('Suche').'…';
$oBar->setElement($oFilter);
$oGui->setBar($oBar);

$oBar			= $oGui->createBar();
$oBar->width	= '100%';
$oIcon			= $oBar->createNewIcon(L10N::t('Neuer Eintrag', $oGui->gui_description), $oDialog, L10N::t('Neuer Eintrag', $oGui->gui_description));
$oBar->setElement($oIcon);
$oIcon			= $oBar->createEditIcon(L10N::t('Editieren', $oGui->gui_description), $oDialog, L10N::t('Editieren', $oGui->gui_description));
$oBar->setElement($oIcon);
$oIcon			= $oBar->createDeleteIcon(L10N::t('Löschen', $oGui->gui_description), L10N::t('Löschen', $oGui->gui_description));
$oBar->setElement($oIcon);
$oGui->setBar($oBar);

$oBar			= $oGui->createBar();
$oBar->width	= '100%';
$oBar->position	= 'top';
$oPagination	= $oBar->createPagination();
$oBar->setElement($oPagination);
$oLoading		= $oBar->createLoadingIndicator();
$oBar->setElement($oLoading);
$oGui->setBar($oBar);

// Spalten
$oColumn				= $oGui->createColumn();
$oColumn->db_column		= 'name';
$oColumn->db_alias		= '';
$oColumn->title			= L10N::t('Bezeichnung', $oGui->gui_description);
$oColumn->width			= Ext_Thebing_Util::getTableColumnWidth('name');
$oColumn->width_resize	= true;
$oColumn->inplaceEditor	= 0;
$oGui->setColumn($oColumn);

$oColumn				= $oGui->createColumn();
$oColumn->db_column		= 'changed';
$oColumn->db_alias		= '';
$oColumn->title			= L10N::t('Verändert', $oGui->gui_description);
$oColumn->width			= Ext_Thebing_Util::getTableColumnWidth('date');
$oColumn->width_resize	= false;
$oColumn->inplaceEditor	= 0;
$oColumn->format		= new Ext_Thebing_Gui2_Format_Date_DateTime();
$oGui->setColumn($oColumn);

$oColumn				= $oGui->createColumn();
$oColumn->db_column		= 'user_id';
$oColumn->db_alias		= '';
$oColumn->title			= L10N::t('Bearbeiter', $oGui->gui_description);
$oColumn->width			= Ext_Thebing_Util::getTableColumnWidth('name');
$oColumn->width_resize	= false;
$oColumn->inplaceEditor	= 0;
$oColumn->format		= new Ext_Gui2_View_Format_UserName();
$oGui->setColumn($oColumn);

$oColumn				= $oGui->createColumn();
$oColumn->db_column		= 'created';
$oColumn->db_alias		= '';
$oColumn->title			= L10N::t('Erstellt', $oGui->gui_description);
$oColumn->width			= Ext_Thebing_Util::getTableColumnWidth('date');
$oColumn->width_resize	= false;
$oColumn->inplaceEditor	= 0;
$oColumn->format		= new Ext_Thebing_Gui2_Format_Date_DateTime();
$oGui->setColumn($oColumn);

$oGui->display($aOptionalInfo);