var Rico={Version:"1.1.2",prototypeVersion:parseFloat(Prototype.Version.split(".")[0]+"."+Prototype.Version.split(".")[1])};if((typeof Prototype=="undefined")||Rico.prototypeVersion<1.3){throw ("Rico requires the Prototype JavaScript framework >= 1.3");}Rico.ArrayExtensions=new Array();if(Object.prototype.extend){Rico.ArrayExtensions[Rico.ArrayExtensions.length]=Object.prototype.extend;}else{Object.prototype.extend=function(_1){return Object.extend.apply(this,[this,_1]);};Rico.ArrayExtensions[Rico.ArrayExtensions.length]=Object.prototype.extend;}if(Array.prototype.push){Rico.ArrayExtensions[Rico.ArrayExtensions.length]=Array.prototype.push;}if(!Array.prototype.remove){Array.prototype.remove=function(dx){if(isNaN(dx)||dx>this.length){return false;}for(var i=0,n=0;i<this.length;i++){if(i!=dx){this[n++]=this[i];}}this.length-=1;};Rico.ArrayExtensions[Rico.ArrayExtensions.length]=Array.prototype.remove;}if(!Array.prototype.removeItem){Array.prototype.removeItem=function(_4){for(var i=0;i<this.length;i++){if(this[i]==_4){this.remove(i);break;}}};Rico.ArrayExtensions[Rico.ArrayExtensions.length]=Array.prototype.removeItem;}if(!Array.prototype.indices){Array.prototype.indices=function(){var _6=new Array();for(index in this){var _7=false;for(var i=0;i<Rico.ArrayExtensions.length;i++){if(this[index]==Rico.ArrayExtensions[i]){_7=true;break;}}if(!_7){_6[_6.length]=index;}}return _6;};Rico.ArrayExtensions[Rico.ArrayExtensions.length]=Array.prototype.indices;}if(window.DOMParser&&window.XMLSerializer&&window.Node&&Node.prototype&&Node.prototype.__defineGetter__){if(!Document.prototype.loadXML){Document.prototype.loadXML=function(s){var _a=(new DOMParser()).parseFromString(s,"text/xml");while(this.hasChildNodes()){this.removeChild(this.lastChild);}for(var i=0;i<_a.childNodes.length;i++){this.appendChild(this.importNode(_a.childNodes[i],true));}};}Document.prototype.__defineGetter__("xml",function(){return (new XMLSerializer()).serializeToString(this);});}document.getElementsByTagAndClassName=function(_c,_d){if(_c==null){_c="*";}var _e=document.getElementsByTagName(_c)||document.all;var _f=new Array();if(_d==null){return _e;}for(var i=0;i<_e.length;i++){var _11=_e[i];var _12=_11.className.split(" ");for(var j=0;j<_12.length;j++){if(_12[j]==_d){_f.push(_11);break;}}}return _f;};Rico.Accordion=Class.create();Rico.Accordion.prototype={initialize:function(_14,_15){this.container=$(_14);this.lastExpandedTab=null;this.accordionTabs=new Array();this.setOptions(_15);this._attachBehaviors();if(!_14){return;}this.container.style.borderBottom="1px solid "+this.options.borderColor;if(this.options.onLoadShowTab>=this.accordionTabs.length){this.options.onLoadShowTab=0;}for(var i=0;i<this.accordionTabs.length;i++){if(i!=this.options.onLoadShowTab){this.accordionTabs[i].collapse();this.accordionTabs[i].content.style.display="none";}}this.lastExpandedTab=this.accordionTabs[this.options.onLoadShowTab];if(this.options.panelHeight=="auto"){var _17=(this.options.onloadShowTab===0)?1:0;var _18=parseInt(RicoUtil.getElementsComputedStyle(this.accordionTabs[_17].titleBar,"height"));if(isNaN(_18)){_18=this.accordionTabs[_17].titleBar.offsetHeight;}var _19=this.accordionTabs.length*_18;var _1a=parseInt(RicoUtil.getElementsComputedStyle(this.container.parentNode,"height"));if(isNaN(_1a)){_1a=this.container.parentNode.offsetHeight;}this.options.panelHeight=_1a-_19-2;}this.lastExpandedTab.content.style.height=this.options.panelHeight+"px";this.lastExpandedTab.showExpanded();this.lastExpandedTab.titleBar.style.fontWeight=this.options.expandedFontWeight;},setOptions:function(_1b){this.options={expandedBg:"#63699c",hoverBg:"#63699c",collapsedBg:"#6b79a5",expandedTextColor:"#ffffff",expandedFontWeight:"bold",hoverTextColor:"#ffffff",collapsedTextColor:"#ced7ef",collapsedFontWeight:"normal",hoverTextColor:"#ffffff",borderColor:"#1f669b",panelHeight:200,onHideTab:null,onShowTab:null,onLoadShowTab:0};Object.extend(this.options,_1b||{});},showTabByIndex:function(_1c,_1d){var _1e=arguments.length==1?true:_1d;this.showTab(this.accordionTabs[_1c],_1e);},showTab:function(_1f,_20){if(this.lastExpandedTab==_1f){return;}var _21=arguments.length==1?true:_20;if(this.options.onHideTab){this.options.onHideTab(this.lastExpandedTab);}this.lastExpandedTab.showCollapsed();var _22=this;var _23=this.lastExpandedTab;this.lastExpandedTab.content.style.height=(this.options.panelHeight-1)+"px";_1f.content.style.display="";_1f.titleBar.style.fontWeight=this.options.expandedFontWeight;if(_21){new Rico.Effect.AccordionSize(this.lastExpandedTab.content,_1f.content,1,this.options.panelHeight,100,10,{complete:function(){_22.showTabDone(_23);}});this.lastExpandedTab=_1f;}else{this.lastExpandedTab.content.style.height="1px";_1f.content.style.height=this.options.panelHeight+"px";this.lastExpandedTab=_1f;this.showTabDone(_23);}},showTabDone:function(_24){_24.content.style.display="none";this.lastExpandedTab.showExpanded();if(this.options.onShowTab){this.options.onShowTab(this.lastExpandedTab);}},_attachBehaviors:function(){var _25=this._getDirectChildrenByTag(this.container,"DIV");for(var i=0;i<_25.length;i++){var _27=this._getDirectChildrenByTag(_25[i],"DIV");if(_27.length!=2){continue;}var _28=_27[0];var _29=_27[1];this.accordionTabs.push(new Rico.Accordion.Tab(this,_28,_29));}},_getDirectChildrenByTag:function(e,_2b){var _2c=new Array();var _2d=e.childNodes;for(var i=0;i<_2d.length;i++){if(_2d[i]&&_2d[i].tagName&&_2d[i].tagName==_2b){_2c.push(_2d[i]);}}return _2c;}};Rico.Accordion.Tab=Class.create();Rico.Accordion.Tab.prototype={initialize:function(_2f,_30,_31){this.accordion=_2f;this.titleBar=_30;this.content=_31;this._attachBehaviors();},collapse:function(){this.showCollapsed();this.content.style.height="1px";},showCollapsed:function(){this.expanded=false;this.titleBar.style.backgroundColor=this.accordion.options.collapsedBg;this.titleBar.style.color=this.accordion.options.collapsedTextColor;this.titleBar.style.fontWeight=this.accordion.options.collapsedFontWeight;this.content.style.overflow="hidden";},showExpanded:function(){this.expanded=true;this.titleBar.style.backgroundColor=this.accordion.options.expandedBg;this.titleBar.style.color=this.accordion.options.expandedTextColor;this.content.style.overflow="auto";},titleBarClicked:function(e){if(this.accordion.lastExpandedTab==this){return;}this.accordion.showTab(this);},hover:function(e){this.titleBar.style.backgroundColor=this.accordion.options.hoverBg;this.titleBar.style.color=this.accordion.options.hoverTextColor;},unhover:function(e){if(this.expanded){this.titleBar.style.backgroundColor=this.accordion.options.expandedBg;this.titleBar.style.color=this.accordion.options.expandedTextColor;}else{this.titleBar.style.backgroundColor=this.accordion.options.collapsedBg;this.titleBar.style.color=this.accordion.options.collapsedTextColor;}},_attachBehaviors:function(){this.content.style.border="1px solid "+this.accordion.options.borderColor;this.content.style.borderTopWidth="0px";this.content.style.borderBottomWidth="0px";this.content.style.margin="0px";this.titleBar.onclick=this.titleBarClicked.bindAsEventListener(this);this.titleBar.onmouseover=this.hover.bindAsEventListener(this);this.titleBar.onmouseout=this.unhover.bindAsEventListener(this);}};Rico.AjaxEngine=Class.create();Rico.AjaxEngine.prototype={initialize:function(){this.ajaxElements=new Array();this.ajaxObjects=new Array();this.requestURLS=new Array();this.options={};},registerAjaxElement:function(_35,_36){if(!_36){_36=$(_35);}this.ajaxElements[_35]=_36;},registerAjaxObject:function(_37,_38){this.ajaxObjects[_37]=_38;},registerRequest:function(_39,_3a){this.requestURLS[_39]=_3a;},sendRequest:function(_3b,_3c){if(arguments.length>=2){if(typeof arguments[1]=="string"){_3c={parameters:this._createQueryString(arguments,1)};}}this.sendRequestWithData(_3b,null,_3c);},sendRequestWithData:function(_3d,_3e,_3f){var _40=this.requestURLS[_3d];if(_40==null){return;}if(arguments.length>=3){if(typeof arguments[2]=="string"){_3f.parameters=this._createQueryString(arguments,2);}}new Ajax.Request(_40,this._requestOptions(_3f,_3e));},sendRequestAndUpdate:function(_41,_42,_43){if(arguments.length>=3){if(typeof arguments[2]=="string"){_43.parameters=this._createQueryString(arguments,2);}}this.sendRequestWithDataAndUpdate(_41,null,_42,_43);},sendRequestWithDataAndUpdate:function(_44,_45,_46,_47){var _48=this.requestURLS[_44];if(_48==null){return;}if(arguments.length>=4){if(typeof arguments[3]=="string"){_47.parameters=this._createQueryString(arguments,3);}}var _49=this._requestOptions(_47,_45);new Ajax.Updater(_46,_48,_49);},_requestOptions:function(_4a,_4b){var _4c=["X-Rico-Version",Rico.Version];var _4d="post";if(_4b==null){if(Rico.prototypeVersion<1.4){_4c.push("Content-type","text/xml");}else{_4d="get";}}(!_4a)?_4a={}:"";if(!_4a._RicoOptionsProcessed){if(_4a.onComplete){_4a.onRicoComplete=_4a.onComplete;}if(_4a.overrideOnComplete){_4a.onComplete=_4a.overrideOnComplete;}else{_4a.onComplete=this._onRequestComplete.bind(this);}_4a._RicoOptionsProcessed=true;}this.options={requestHeaders:_4c,parameters:_4a.parameters,postBody:_4b,method:_4d,onComplete:_4a.onComplete};Object.extend(this.options,_4a);return this.options;},_createQueryString:function(_4e,_4f){var _50="";for(var i=_4f;i<_4e.length;i++){if(i!=_4f){_50+="&";}var _52=_4e[i];if(_52.name!=undefined&&_52.value!=undefined){_50+=_52.name+"="+escape(_52.value);}else{var _53=_52.indexOf("=");var _54=_52.substring(0,_53);var _55=_52.substring(_53+1);_50+=_54+"="+escape(_55);}}return _50;},_onRequestComplete:function(_56){if(!_56){return;}if(_56.status!=200){return;}var _57=_56.responseXML.getElementsByTagName("ajax-response");if(_57==null||_57.length!=1){return;}this._processAjaxResponse(_57[0].childNodes);var _58=this.options.onRicoComplete;if(_58!=null){_58();}},_processAjaxResponse:function(_59){for(var i=0;i<_59.length;i++){var _5b=_59[i];if(_5b.nodeType!=1){continue;}var _5c=_5b.getAttribute("type");var _5d=_5b.getAttribute("id");if(_5c=="object"){this._processAjaxObjectUpdate(this.ajaxObjects[_5d],_5b);}else{if(_5c=="element"){this._processAjaxElementUpdate(this.ajaxElements[_5d],_5b);}else{alert("unrecognized AjaxResponse type : "+_5c);}}}},_processAjaxObjectUpdate:function(_5e,_5f){_5e.ajaxUpdate(_5f);},_processAjaxElementUpdate:function(_60,_61){_60.innerHTML=RicoUtil.getContentAsString(_61);}};var ajaxEngine=new Rico.AjaxEngine();Rico.Color=Class.create();Rico.Color.prototype={initialize:function(red,_63,_64){this.rgb={r:red,g:_63,b:_64};},setRed:function(r){this.rgb.r=r;},setGreen:function(g){this.rgb.g=g;},setBlue:function(b){this.rgb.b=b;},setHue:function(h){var hsb=this.asHSB();hsb.h=h;this.rgb=Rico.Color.HSBtoRGB(hsb.h,hsb.s,hsb.b);},setSaturation:function(s){var hsb=this.asHSB();hsb.s=s;this.rgb=Rico.Color.HSBtoRGB(hsb.h,hsb.s,hsb.b);},setBrightness:function(b){var hsb=this.asHSB();hsb.b=b;this.rgb=Rico.Color.HSBtoRGB(hsb.h,hsb.s,hsb.b);},darken:function(_6e){var hsb=this.asHSB();this.rgb=Rico.Color.HSBtoRGB(hsb.h,hsb.s,Math.max(hsb.b-_6e,0));},brighten:function(_70){var hsb=this.asHSB();this.rgb=Rico.Color.HSBtoRGB(hsb.h,hsb.s,Math.min(hsb.b+_70,1));},blend:function(_72){this.rgb.r=Math.floor((this.rgb.r+_72.rgb.r)/2);this.rgb.g=Math.floor((this.rgb.g+_72.rgb.g)/2);this.rgb.b=Math.floor((this.rgb.b+_72.rgb.b)/2);},isBright:function(){var hsb=this.asHSB();return this.asHSB().b>0.5;},isDark:function(){return !this.isBright();},asRGB:function(){return "rgb("+this.rgb.r+","+this.rgb.g+","+this.rgb.b+")";},asHex:function(){return "#"+this.rgb.r.toColorPart()+this.rgb.g.toColorPart()+this.rgb.b.toColorPart();},asHSB:function(){return Rico.Color.RGBtoHSB(this.rgb.r,this.rgb.g,this.rgb.b);},toString:function(){return this.asHex();}};Rico.Color.createFromHex=function(_74){if(_74.length==4){var _75=_74;var _76="#";for(var i=1;i<4;i++){_76+=(_75.charAt(i)+_75.charAt(i));}}if(_76.indexOf("#")==0){_76=_76.substring(1);}var red=_76.substring(0,2);var _79=_76.substring(2,4);var _7a=_76.substring(4,6);return new Rico.Color(parseInt(red,16),parseInt(_79,16),parseInt(_7a,16));};Rico.Color.createColorFromBackground=function(_7b){var _7c=RicoUtil.getElementsComputedStyle($(_7b),"backgroundColor","background-color");if(_7c=="transparent"&&_7b.parentNode){return Rico.Color.createColorFromBackground(_7b.parentNode);}if(_7c==null){return new Rico.Color(255,255,255);}if(_7c.indexOf("rgb(")==0){var _7d=_7c.substring(4,_7c.length-1);var _7e=_7d.split(",");return new Rico.Color(parseInt(_7e[0]),parseInt(_7e[1]),parseInt(_7e[2]));}else{if(_7c.indexOf("#")==0){return Rico.Color.createFromHex(_7c);}else{return new Rico.Color(255,255,255);}}};Rico.Color.HSBtoRGB=function(hue,_80,_81){var red=0;var _83=0;var _84=0;if(_80==0){red=parseInt(_81*255+0.5);_83=red;_84=red;}else{var h=(hue-Math.floor(hue))*6;var f=h-Math.floor(h);var p=_81*(1-_80);var q=_81*(1-_80*f);var t=_81*(1-(_80*(1-f)));switch(parseInt(h)){case 0:red=(_81*255+0.5);_83=(t*255+0.5);_84=(p*255+0.5);break;case 1:red=(q*255+0.5);_83=(_81*255+0.5);_84=(p*255+0.5);break;case 2:red=(p*255+0.5);_83=(_81*255+0.5);_84=(t*255+0.5);break;case 3:red=(p*255+0.5);_83=(q*255+0.5);_84=(_81*255+0.5);break;case 4:red=(t*255+0.5);_83=(p*255+0.5);_84=(_81*255+0.5);break;case 5:red=(_81*255+0.5);_83=(p*255+0.5);_84=(q*255+0.5);break;}}return {r:parseInt(red),g:parseInt(_83),b:parseInt(_84)};};Rico.Color.RGBtoHSB=function(r,g,b){var hue;var _8e;var _8f;var _90=(r>g)?r:g;if(b>_90){_90=b;}var _91=(r<g)?r:g;if(b<_91){_91=b;}_8f=_90/255;if(_90!=0){_8e=(_90-_91)/_90;}else{_8e=0;}if(_8e==0){hue=0;}else{var _92=(_90-r)/(_90-_91);var _93=(_90-g)/(_90-_91);var _94=(_90-b)/(_90-_91);if(r==_90){hue=_94-_93;}else{if(g==_90){hue=2+_92-_94;}else{hue=4+_93-_92;}}hue=hue/6;if(hue<0){hue=hue+1;}}return {h:hue,s:_8e,b:_8f};};Rico.Corner={round:function(e,_96){var e=$(e);this._setOptions(_96);var _98=this.options.color;if(this.options.color=="fromElement"){_98=this._background(e);}var _99=this.options.bgColor;if(this.options.bgColor=="fromParent"){_99=this._background(e.offsetParent);}this._roundCornersImpl(e,_98,_99);},_roundCornersImpl:function(e,_9b,_9c){if(this.options.border){this._renderBorder(e,_9c);}if(this._isTopRounded()){this._roundTopCorners(e,_9b,_9c);}if(this._isBottomRounded()){this._roundBottomCorners(e,_9b,_9c);}},_renderBorder:function(el,_9e){var _9f="1px solid "+this._borderColor(_9e);var _a0="border-left: "+_9f;var _a1="border-right: "+_9f;var _a2="style='"+_a0+";"+_a1+"'";el.innerHTML="<div "+_a2+">"+el.innerHTML+"</div>";},_roundTopCorners:function(el,_a4,_a5){var _a6=this._createCorner(_a5);for(var i=0;i<this.options.numSlices;i++){_a6.appendChild(this._createCornerSlice(_a4,_a5,i,"top"));}el.style.paddingTop=0;el.insertBefore(_a6,el.firstChild);},_roundBottomCorners:function(el,_a9,_aa){var _ab=this._createCorner(_aa);for(var i=(this.options.numSlices-1);i>=0;i--){_ab.appendChild(this._createCornerSlice(_a9,_aa,i,"bottom"));}el.style.paddingBottom=0;el.appendChild(_ab);},_createCorner:function(_ad){var _ae=document.createElement("div");_ae.style.backgroundColor=(this._isTransparent()?"transparent":_ad);return _ae;},_createCornerSlice:function(_af,_b0,n,_b2){var _b3=document.createElement("span");var _b4=_b3.style;_b4.backgroundColor=_af;_b4.display="block";_b4.height="1px";_b4.overflow="hidden";_b4.fontSize="1px";var _b5=this._borderColor(_af,_b0);if(this.options.border&&n==0){_b4.borderTopStyle="solid";_b4.borderTopWidth="1px";_b4.borderLeftWidth="0px";_b4.borderRightWidth="0px";_b4.borderBottomWidth="0px";_b4.height="0px";_b4.borderColor=_b5;}else{if(_b5){_b4.borderColor=_b5;_b4.borderStyle="solid";_b4.borderWidth="0px 1px";}}if(!this.options.compact&&(n==(this.options.numSlices-1))){_b4.height="2px";}this._setMargin(_b3,n,_b2);this._setBorder(_b3,n,_b2);return _b3;},_setOptions:function(_b6){this.options={corners:"all",color:"fromElement",bgColor:"fromParent",blend:true,border:false,compact:false};Object.extend(this.options,_b6||{});this.options.numSlices=this.options.compact?2:4;if(this._isTransparent()){this.options.blend=false;}},_whichSideTop:function(){if(this._hasString(this.options.corners,"all","top")){return "";}if(this.options.corners.indexOf("tl")>=0&&this.options.corners.indexOf("tr")>=0){return "";}if(this.options.corners.indexOf("tl")>=0){return "left";}else{if(this.options.corners.indexOf("tr")>=0){return "right";}}return "";},_whichSideBottom:function(){if(this._hasString(this.options.corners,"all","bottom")){return "";}if(this.options.corners.indexOf("bl")>=0&&this.options.corners.indexOf("br")>=0){return "";}if(this.options.corners.indexOf("bl")>=0){return "left";}else{if(this.options.corners.indexOf("br")>=0){return "right";}}return "";},_borderColor:function(_b7,_b8){if(_b7=="transparent"){return _b8;}else{if(this.options.border){return this.options.border;}else{if(this.options.blend){return this._blend(_b8,_b7);}else{return "";}}}},_setMargin:function(el,n,_bb){var _bc=this._marginSize(n);var _bd=_bb=="top"?this._whichSideTop():this._whichSideBottom();if(_bd=="left"){el.style.marginLeft=_bc+"px";el.style.marginRight="0px";}else{if(_bd=="right"){el.style.marginRight=_bc+"px";el.style.marginLeft="0px";}else{el.style.marginLeft=_bc+"px";el.style.marginRight=_bc+"px";}}},_setBorder:function(el,n,_c0){var _c1=this._borderSize(n);var _c2=_c0=="top"?this._whichSideTop():this._whichSideBottom();if(_c2=="left"){el.style.borderLeftWidth=_c1+"px";el.style.borderRightWidth="0px";}else{if(_c2=="right"){el.style.borderRightWidth=_c1+"px";el.style.borderLeftWidth="0px";}else{el.style.borderLeftWidth=_c1+"px";el.style.borderRightWidth=_c1+"px";}}if(this.options.border!=false){el.style.borderLeftWidth=_c1+"px";}el.style.borderRightWidth=_c1+"px";},_marginSize:function(n){if(this._isTransparent()){return 0;}var _c4=[5,3,2,1];var _c5=[3,2,1,0];var _c6=[2,1];var _c7=[1,0];if(this.options.compact&&this.options.blend){return _c7[n];}else{if(this.options.compact){return _c6[n];}else{if(this.options.blend){return _c5[n];}else{return _c4[n];}}}},_borderSize:function(n){var _c9=[5,3,2,1];var _ca=[2,1,1,1];var _cb=[1,0];var _cc=[0,2,0,0];if(this.options.compact&&(this.options.blend||this._isTransparent())){return 1;}else{if(this.options.compact){return _cb[n];}else{if(this.options.blend){return _ca[n];}else{if(this.options.border){return _cc[n];}else{if(this._isTransparent()){return _c9[n];}}}}}return 0;},_hasString:function(str){for(var i=1;i<arguments.length;i++){if(str.indexOf(arguments[i])>=0){return true;}}return false;},_blend:function(c1,c2){var cc1=Rico.Color.createFromHex(c1);cc1.blend(Rico.Color.createFromHex(c2));return cc1;},_background:function(el){try{return Rico.Color.createColorFromBackground(el).asHex();}catch(err){return "#ffffff";}},_isTransparent:function(){return this.options.color=="transparent";},_isTopRounded:function(){return this._hasString(this.options.corners,"all","top","tl","tr");},_isBottomRounded:function(){return this._hasString(this.options.corners,"all","bottom","bl","br");},_hasSingleTextChild:function(el){return el.childNodes.length==1&&el.childNodes[0].nodeType==3;}};Rico.DragAndDrop=Class.create();Rico.DragAndDrop.prototype={initialize:function(){this.dropZones=new Array();this.draggables=new Array();this.currentDragObjects=new Array();this.dragElement=null;this.lastSelectedDraggable=null;this.currentDragObjectVisible=false;this.interestedInMotionEvents=false;this._mouseDown=this._mouseDownHandler.bindAsEventListener(this);this._mouseMove=this._mouseMoveHandler.bindAsEventListener(this);this._mouseUp=this._mouseUpHandler.bindAsEventListener(this);},registerDropZone:function(_d4){this.dropZones[this.dropZones.length]=_d4;},deregisterDropZone:function(_d5){var _d6=new Array();var j=0;for(var i=0;i<this.dropZones.length;i++){if(this.dropZones[i]!=_d5){_d6[j++]=this.dropZones[i];}}this.dropZones=_d6;},clearDropZones:function(){this.dropZones=new Array();},registerDraggable:function(_d9){this.draggables[this.draggables.length]=_d9;this._addMouseDownHandler(_d9);},clearSelection:function(){for(var i=0;i<this.currentDragObjects.length;i++){this.currentDragObjects[i].deselect();}this.currentDragObjects=new Array();this.lastSelectedDraggable=null;},hasSelection:function(){return this.currentDragObjects.length>0;},setStartDragFromElement:function(e,_dc){this.origPos=RicoUtil.toDocumentPosition(_dc);this.startx=e.screenX-this.origPos.x;this.starty=e.screenY-this.origPos.y;this.interestedInMotionEvents=this.hasSelection();this._terminateEvent(e);},updateSelection:function(_dd,_de){if(!_de){this.clearSelection();}if(_dd.isSelected()){this.currentDragObjects.removeItem(_dd);_dd.deselect();if(_dd==this.lastSelectedDraggable){this.lastSelectedDraggable=null;}}else{this.currentDragObjects[this.currentDragObjects.length]=_dd;_dd.select();this.lastSelectedDraggable=_dd;}},_mouseDownHandler:function(e){if(arguments.length==0){e=event;}var _e0=e.which!=undefined;if((_e0&&e.which!=1)||(!_e0&&e.button!=1)){return;}var _e1=e.target?e.target:e.srcElement;var _e2=_e1.draggable;var _e3=_e1;while(_e2==null&&_e3.parentNode){_e3=_e3.parentNode;_e2=_e3.draggable;}if(_e2==null){return;}this.updateSelection(_e2,e.ctrlKey);if(this.hasSelection()){for(var i=0;i<this.dropZones.length;i++){this.dropZones[i].clearPositionCache();}}this.setStartDragFromElement(e,_e2.getMouseDownHTMLElement());},_mouseMoveHandler:function(e){var _e6=e.which!=undefined;if(!this.interestedInMotionEvents){return;}if(!this.hasSelection()){return;}if(!this.currentDragObjectVisible){this._startDrag(e);}if(!this.activatedDropZones){this._activateRegisteredDropZones();}this._updateDraggableLocation(e);this._updateDropZonesHover(e);this._terminateEvent(e);},_makeDraggableObjectVisible:function(e){if(!this.hasSelection()){return;}var _e8;if(this.currentDragObjects.length>1){_e8=this.currentDragObjects[0].getMultiObjectDragGUI(this.currentDragObjects);}else{_e8=this.currentDragObjects[0].getSingleObjectDragGUI();}if(RicoUtil.getElementsComputedStyle(_e8,"position")!="absolute"){_e8.style.position="absolute";}if(_e8.parentNode==null||_e8.parentNode.nodeType==11){document.body.appendChild(_e8);}this.dragElement=_e8;this._updateDraggableLocation(e);this.currentDragObjectVisible=true;},_leftOffset:function(e){return e.offsetX?document.body.scrollLeft:0;},_topOffset:function(e){return e.offsetY?document.body.scrollTop:0;},_updateDraggableLocation:function(e){var _ec=this.dragElement.style;_ec.left=(e.screenX+this._leftOffset(e)-this.startx)+"px";_ec.top=(e.screenY+this._topOffset(e)-this.starty)+"px";},_updateDropZonesHover:function(e){var n=this.dropZones.length;for(var i=0;i<n;i++){if(!this._mousePointInDropZone(e,this.dropZones[i])){this.dropZones[i].hideHover();}}for(var i=0;i<n;i++){if(this._mousePointInDropZone(e,this.dropZones[i])){if(this.dropZones[i].canAccept(this.currentDragObjects)){this.dropZones[i].showHover();}}}},_startDrag:function(e){for(var i=0;i<this.currentDragObjects.length;i++){this.currentDragObjects[i].startDrag();}this._makeDraggableObjectVisible(e);},_mouseUpHandler:function(e){if(!this.hasSelection()){return;}var _f4=e.which!=undefined;if((_f4&&e.which!=1)||(!_f4&&e.button!=1)){return;}this.interestedInMotionEvents=false;if(this.dragElement==null){this._terminateEvent(e);return;}if(this._placeDraggableInDropZone(e)){this._completeDropOperation(e);}else{this._terminateEvent(e);new Rico.Effect.Position(this.dragElement,this.origPos.x,this.origPos.y,200,20,{complete:this._doCancelDragProcessing.bind(this)});}Event.stopObserving(document.body,"mousemove",this._mouseMove);Event.stopObserving(document.body,"mouseup",this._mouseUp);},_retTrue:function(){return true;},_completeDropOperation:function(e){if(this.dragElement!=this.currentDragObjects[0].getMouseDownHTMLElement()){if(this.dragElement.parentNode!=null){this.dragElement.parentNode.removeChild(this.dragElement);}}this._deactivateRegisteredDropZones();this._endDrag();this.clearSelection();this.dragElement=null;this.currentDragObjectVisible=false;this._terminateEvent(e);},_doCancelDragProcessing:function(){this._cancelDrag();if(this.dragElement!=this.currentDragObjects[0].getMouseDownHTMLElement()&&this.dragElement){if(this.dragElement.parentNode!=null){this.dragElement.parentNode.removeChild(this.dragElement);}}this._deactivateRegisteredDropZones();this.dragElement=null;this.currentDragObjectVisible=false;},_placeDraggableInDropZone:function(e){var _f7=false;var n=this.dropZones.length;for(var i=0;i<n;i++){if(this._mousePointInDropZone(e,this.dropZones[i])){if(this.dropZones[i].canAccept(this.currentDragObjects)){this.dropZones[i].hideHover();this.dropZones[i].accept(this.currentDragObjects);_f7=true;break;}}}return _f7;},_cancelDrag:function(){for(var i=0;i<this.currentDragObjects.length;i++){this.currentDragObjects[i].cancelDrag();}},_endDrag:function(){for(var i=0;i<this.currentDragObjects.length;i++){this.currentDragObjects[i].endDrag();}},_mousePointInDropZone:function(e,_fd){var _fe=_fd.getAbsoluteRect();return e.clientX>_fe.left+this._leftOffset(e)&&e.clientX<_fe.right+this._leftOffset(e)&&e.clientY>_fe.top+this._topOffset(e)&&e.clientY<_fe.bottom+this._topOffset(e);},_addMouseDownHandler:function(_ff){htmlElement=_ff.getMouseDownHTMLElement();if(htmlElement!=null){htmlElement.draggable=_ff;Event.observe(htmlElement,"mousedown",this._onmousedown.bindAsEventListener(this));Event.observe(htmlElement,"mousedown",this._mouseDown);}},_activateRegisteredDropZones:function(){var n=this.dropZones.length;for(var i=0;i<n;i++){var _102=this.dropZones[i];if(_102.canAccept(this.currentDragObjects)){_102.activate();}}this.activatedDropZones=true;},_deactivateRegisteredDropZones:function(){var n=this.dropZones.length;for(var i=0;i<n;i++){this.dropZones[i].deactivate();}this.activatedDropZones=false;},_onmousedown:function(){Event.observe(document.body,"mousemove",this._mouseMove);Event.observe(document.body,"mouseup",this._mouseUp);},_terminateEvent:function(e){if(e.stopPropagation!=undefined){e.stopPropagation();}else{if(e.cancelBubble!=undefined){e.cancelBubble=true;}}if(e.preventDefault!=undefined){e.preventDefault();}else{e.returnValue=false;}},initializeEventHandlers:function(){if(typeof document.implementation!="undefined"&&document.implementation.hasFeature("HTML","1.0")&&document.implementation.hasFeature("Events","2.0")&&document.implementation.hasFeature("CSS","2.0")){document.addEventListener("mouseup",this._mouseUpHandler.bindAsEventListener(this),false);document.addEventListener("mousemove",this._mouseMoveHandler.bindAsEventListener(this),false);}else{document.attachEvent("onmouseup",this._mouseUpHandler.bindAsEventListener(this));document.attachEvent("onmousemove",this._mouseMoveHandler.bindAsEventListener(this));}}};var dndMgr=new Rico.DragAndDrop();dndMgr.initializeEventHandlers();Rico.Draggable=Class.create();Rico.Draggable.prototype={initialize:function(type,_107){this.type=type;this.htmlElement=$(_107);this.selected=false;},getMouseDownHTMLElement:function(){return this.htmlElement;},select:function(){this.selected=true;if(this.showingSelected){return;}var _108=this.getMouseDownHTMLElement();var _109=Rico.Color.createColorFromBackground(_108);_109.isBright()?_109.darken(0.033):_109.brighten(0.033);this.saveBackground=RicoUtil.getElementsComputedStyle(_108,"backgroundColor","background-color");_108.style.backgroundColor=_109.asHex();this.showingSelected=true;},deselect:function(){this.selected=false;if(!this.showingSelected){return;}var _10a=this.getMouseDownHTMLElement();_10a.style.backgroundColor=this.saveBackground;this.showingSelected=false;},isSelected:function(){return this.selected;},startDrag:function(){},cancelDrag:function(){},endDrag:function(){},getSingleObjectDragGUI:function(){return this.htmlElement;},getMultiObjectDragGUI:function(_10b){return this.htmlElement;},getDroppedGUI:function(){return this.htmlElement;},toString:function(){return this.type+":"+this.htmlElement+":";}};Rico.Dropzone=Class.create();Rico.Dropzone.prototype={initialize:function(_10c){this.htmlElement=$(_10c);this.absoluteRect=null;},getHTMLElement:function(){return this.htmlElement;},clearPositionCache:function(){this.absoluteRect=null;},getAbsoluteRect:function(){if(this.absoluteRect==null){var _10d=this.getHTMLElement();var pos=RicoUtil.toViewportPosition(_10d);this.absoluteRect={top:pos.y,left:pos.x,bottom:pos.y+_10d.offsetHeight,right:pos.x+_10d.offsetWidth};}return this.absoluteRect;},activate:function(){var _10f=this.getHTMLElement();if(_10f==null||this.showingActive){return;}this.showingActive=true;this.saveBackgroundColor=_10f.style.backgroundColor;var _110="#ffea84";var _111=Rico.Color.createColorFromBackground(_10f);if(_111==null){_10f.style.backgroundColor=_110;}else{_111.isBright()?_111.darken(0.2):_111.brighten(0.2);_10f.style.backgroundColor=_111.asHex();}},deactivate:function(){var _112=this.getHTMLElement();if(_112==null||!this.showingActive){return;}_112.style.backgroundColor=this.saveBackgroundColor;this.showingActive=false;this.saveBackgroundColor=null;},showHover:function(){var _113=this.getHTMLElement();if(_113==null||this.showingHover){return;}this.saveBorderWidth=_113.style.borderWidth;this.saveBorderStyle=_113.style.borderStyle;this.saveBorderColor=_113.style.borderColor;this.showingHover=true;_113.style.borderWidth="1px";_113.style.borderStyle="solid";_113.style.borderColor="#ffff00";},hideHover:function(){var _114=this.getHTMLElement();if(_114==null||!this.showingHover){return;}_114.style.borderWidth=this.saveBorderWidth;_114.style.borderStyle=this.saveBorderStyle;_114.style.borderColor=this.saveBorderColor;this.showingHover=false;},canAccept:function(_115){return true;},accept:function(_116){var _117=this.getHTMLElement();if(_117==null){return;}n=_116.length;for(var i=0;i<n;i++){var _119=_116[i].getDroppedGUI();if(RicoUtil.getElementsComputedStyle(_119,"position")=="absolute"){_119.style.position="static";_119.style.top="";_119.style.top="";}_117.appendChild(_119);}}};Rico.Effect={};Rico.Effect.SizeAndPosition=Class.create();Rico.Effect.SizeAndPosition.prototype={initialize:function(_11a,x,y,w,h,_11f,_120,_121){this.element=$(_11a);this.x=x;this.y=y;this.w=w;this.h=h;this.duration=_11f;this.steps=_120;this.options=arguments[7]||{};this.sizeAndPosition();},sizeAndPosition:function(){if(this.isFinished()){if(this.options.complete){this.options.complete(this);}return;}if(this.timer){clearTimeout(this.timer);}var _122=Math.round(this.duration/this.steps);var _123=this.element.offsetLeft;var _124=this.element.offsetTop;var _125=this.element.offsetWidth;var _126=this.element.offsetHeight;this.x=(this.x)?this.x:_123;this.y=(this.y)?this.y:_124;this.w=(this.w)?this.w:_125;this.h=(this.h)?this.h:_126;var difX=this.steps>0?(this.x-_123)/this.steps:0;var difY=this.steps>0?(this.y-_124)/this.steps:0;var difW=this.steps>0?(this.w-_125)/this.steps:0;var difH=this.steps>0?(this.h-_126)/this.steps:0;this.moveBy(difX,difY);this.resizeBy(difW,difH);this.duration-=_122;this.steps--;this.timer=setTimeout(this.sizeAndPosition.bind(this),_122);},isFinished:function(){return this.steps<=0;},moveBy:function(difX,difY){var _12d=this.element.offsetLeft;var _12e=this.element.offsetTop;var _12f=parseInt(difX);var _130=parseInt(difY);var _131=this.element.style;if(_12f!=0){_131.left=(_12d+_12f)+"px";}if(_130!=0){_131.top=(_12e+_130)+"px";}},resizeBy:function(difW,difH){var _134=this.element.offsetWidth;var _135=this.element.offsetHeight;var _136=parseInt(difW);var _137=parseInt(difH);var _138=this.element.style;if(_136!=0){_138.width=(_134+_136)+"px";}if(_137!=0){_138.height=(_135+_137)+"px";}}};Rico.Effect.Size=Class.create();Rico.Effect.Size.prototype={initialize:function(_139,w,h,_13c,_13d,_13e){new Rico.Effect.SizeAndPosition(_139,null,null,w,h,_13c,_13d,_13e);}};Rico.Effect.Position=Class.create();Rico.Effect.Position.prototype={initialize:function(_13f,x,y,_142,_143,_144){new Rico.Effect.SizeAndPosition(_13f,x,y,null,null,_142,_143,_144);}};Rico.Effect.Round=Class.create();Rico.Effect.Round.prototype={initialize:function(_145,_146,_147){var _148=document.getElementsByTagAndClassName(_145,_146);for(var i=0;i<_148.length;i++){Rico.Corner.round(_148[i],_147);}}};Rico.Effect.FadeTo=Class.create();Rico.Effect.FadeTo.prototype={initialize:function(_14a,_14b,_14c,_14d,_14e){this.element=$(_14a);this.opacity=_14b;this.duration=_14c;this.steps=_14d;this.options=arguments[4]||{};this.fadeTo();},fadeTo:function(){if(this.isFinished()){if(this.options.complete){this.options.complete(this);}return;}if(this.timer){clearTimeout(this.timer);}var _14f=Math.round(this.duration/this.steps);var _150=this.getElementOpacity();var _151=this.steps>0?(this.opacity-_150)/this.steps:0;this.changeOpacityBy(_151);this.duration-=_14f;this.steps--;this.timer=setTimeout(this.fadeTo.bind(this),_14f);},changeOpacityBy:function(v){var _153=this.getElementOpacity();var _154=Math.max(0,Math.min(_153+v,1));this.element.ricoOpacity=_154;this.element.style.filter="alpha(opacity:"+Math.round(_154*100)+")";this.element.style.opacity=_154;},isFinished:function(){return this.steps<=0;},getElementOpacity:function(){if(this.element.ricoOpacity==undefined){var _155=RicoUtil.getElementsComputedStyle(this.element,"opacity");this.element.ricoOpacity=_155!=undefined?_155:1;}return parseFloat(this.element.ricoOpacity);}};Rico.Effect.AccordionSize=Class.create();Rico.Effect.AccordionSize.prototype={initialize:function(e1,e2,_158,end,_15a,_15b,_15c){this.e1=$(e1);this.e2=$(e2);this.start=_158;this.end=end;this.duration=_15a;this.steps=_15b;this.options=arguments[6]||{};this.accordionSize();},accordionSize:function(){if(this.isFinished()){this.e1.style.height=this.start+"px";this.e2.style.height=this.end+"px";if(this.options.complete){this.options.complete(this);}return;}if(this.timer){clearTimeout(this.timer);}var _15d=Math.round(this.duration/this.steps);var diff=this.steps>0?(parseInt(this.e1.offsetHeight)-this.start)/this.steps:0;this.resizeBy(diff);this.duration-=_15d;this.steps--;this.timer=setTimeout(this.accordionSize.bind(this),_15d);},isFinished:function(){return this.steps<=0;},resizeBy:function(diff){var _160=this.e1.offsetHeight;var _161=this.e2.offsetHeight;var _162=parseInt(diff);if(diff!=0){this.e1.style.height=(_160-_162)+"px";this.e2.style.height=(_161+_162)+"px";}}};Rico.LiveGridMetaData=Class.create();Rico.LiveGridMetaData.prototype={initialize:function(_163,_164,_165,_166){this.pageSize=_163;this.totalRows=_164;this.setOptions(_166);this.ArrowHeight=16;this.columnCount=_165;},setOptions:function(_167){this.options={largeBufferSize:7,nearLimitFactor:0.2};Object.extend(this.options,_167||{});},getPageSize:function(){return this.pageSize;},getTotalRows:function(){return this.totalRows;},setTotalRows:function(n){this.totalRows=n;},getLargeBufferSize:function(){return parseInt(this.options.largeBufferSize*this.pageSize);},getLimitTolerance:function(){return parseInt(this.getLargeBufferSize()*this.options.nearLimitFactor);}};Rico.LiveGridScroller=Class.create();Rico.LiveGridScroller.prototype={initialize:function(_169,_16a){this.isIE=navigator.userAgent.toLowerCase().indexOf("msie")>=0;this.liveGrid=_169;this.metaData=_169.metaData;this.createScrollBar();this.scrollTimeout=null;this.lastScrollPos=0;this.viewPort=_16a;this.rows=new Array();},isUnPlugged:function(){return this.scrollerDiv.onscroll==null;},plugin:function(){this.scrollerDiv.onscroll=this.handleScroll.bindAsEventListener(this);},unplug:function(){this.scrollerDiv.onscroll=null;},sizeIEHeaderHack:function(){if(!this.isIE){return;}var _16b=$(this.liveGrid.tableId+"_header");if(_16b){_16b.rows[0].cells[0].style.width=(_16b.rows[0].cells[0].offsetWidth+1)+"px";}},createScrollBar:function(){var _16c=this.liveGrid.viewPort.visibleHeight();this.scrollerDiv=document.createElement("div");var _16d=this.scrollerDiv.style;_16d.borderRight=this.liveGrid.options.scrollerBorderRight;_16d.position="relative";_16d.left=this.isIE?"-6px":"-3px";_16d.width="19px";_16d.height=_16c+"px";_16d.overflow="auto";this.heightDiv=document.createElement("div");this.heightDiv.style.width="1px";this.heightDiv.style.height=parseInt(_16c*this.metaData.getTotalRows()/this.metaData.getPageSize())+"px";this.scrollerDiv.appendChild(this.heightDiv);this.scrollerDiv.onscroll=this.handleScroll.bindAsEventListener(this);var _16e=this.liveGrid.table;_16e.parentNode.parentNode.insertBefore(this.scrollerDiv,_16e.parentNode.nextSibling);var _16f=this.isIE?"mousewheel":"DOMMouseScroll";Event.observe(_16e,_16f,function(evt){if(evt.wheelDelta>=0||evt.detail<0){this.scrollerDiv.scrollTop-=(2*this.viewPort.rowHeight);}else{this.scrollerDiv.scrollTop+=(2*this.viewPort.rowHeight);}this.handleScroll(false);}.bindAsEventListener(this),false);},updateSize:function(){var _171=this.liveGrid.table;var _172=this.viewPort.visibleHeight();this.heightDiv.style.height=parseInt(_172*this.metaData.getTotalRows()/this.metaData.getPageSize())+"px";},rowToPixel:function(_173){return (_173/this.metaData.getTotalRows())*this.heightDiv.offsetHeight;},moveScroll:function(_174){this.scrollerDiv.scrollTop=this.rowToPixel(_174);if(this.metaData.options.onscroll){this.metaData.options.onscroll(this.liveGrid,_174);}},handleScroll:function(){if(this.scrollTimeout){clearTimeout(this.scrollTimeout);}var _175=this.lastScrollPos-this.scrollerDiv.scrollTop;if(_175!=0){var r=this.scrollerDiv.scrollTop%this.viewPort.rowHeight;if(r!=0){this.unplug();if(_175<0){this.scrollerDiv.scrollTop+=(this.viewPort.rowHeight-r);}else{this.scrollerDiv.scrollTop-=r;}this.plugin();}}var _177=parseInt(this.scrollerDiv.scrollTop/this.viewPort.rowHeight);this.liveGrid.requestContentRefresh(_177);this.viewPort.scrollTo(this.scrollerDiv.scrollTop);if(this.metaData.options.onscroll){this.metaData.options.onscroll(this.liveGrid,_177);}this.scrollTimeout=setTimeout(this.scrollIdle.bind(this),1200);this.lastScrollPos=this.scrollerDiv.scrollTop;},scrollIdle:function(){if(this.metaData.options.onscrollidle){this.metaData.options.onscrollidle();}}};Rico.LiveGridBuffer=Class.create();Rico.LiveGridBuffer.prototype={initialize:function(_178,_179){this.startPos=0;this.size=0;this.metaData=_178;this.rows=new Array();this.updateInProgress=false;this.viewPort=_179;this.maxBufferSize=_178.getLargeBufferSize()*2;this.maxFetchSize=_178.getLargeBufferSize();this.lastOffset=0;},getBlankRow:function(){if(!this.blankRow){this.blankRow=new Array();for(var i=0;i<this.metaData.columnCount;i++){this.blankRow[i]="&nbsp;";}}return this.blankRow;},loadRows:function(_17b){var _17c=_17b.getElementsByTagName("rows")[0];this.updateUI=_17c.getAttribute("update_ui")=="true";var _17d=new Array();var trs=_17c.getElementsByTagName("tr");for(var i=0;i<trs.length;i++){var row=_17d[i]=new Array();var _181=trs[i].getElementsByTagName("td");for(var j=0;j<_181.length;j++){var cell=_181[j];var _184=cell.getAttribute("convert_spaces")=="true";var _185=RicoUtil.getContentAsString(cell);row[j]=_184?this.convertSpaces(_185):_185;if(!row[j]){row[j]="&nbsp;";}}}return _17d;},update:function(_186,_187){var _188=this.loadRows(_186);if(this.rows.length==0){this.rows=_188;this.size=this.rows.length;this.startPos=_187;return;}if(_187>this.startPos){if(this.startPos+this.rows.length<_187){this.rows=_188;this.startPos=_187;}else{this.rows=this.rows.concat(_188.slice(0,_188.length));if(this.rows.length>this.maxBufferSize){var _189=this.rows.length;this.rows=this.rows.slice(this.rows.length-this.maxBufferSize,this.rows.length);this.startPos=this.startPos+(_189-this.rows.length);}}}else{if(_187+_188.length<this.startPos){this.rows=_188;}else{this.rows=_188.slice(0,this.startPos).concat(this.rows);if(this.rows.length>this.maxBufferSize){this.rows=this.rows.slice(0,this.maxBufferSize);}}this.startPos=_187;}this.size=this.rows.length;},clear:function(){this.rows=new Array();this.startPos=0;this.size=0;},isOverlapping:function(_18a,size){return ((_18a<this.endPos())&&(this.startPos<_18a+size))||(this.endPos()==0);},isInRange:function(_18c){return (_18c>=this.startPos)&&(_18c+this.metaData.getPageSize()<=this.endPos());},isNearingTopLimit:function(_18d){return _18d-this.startPos<this.metaData.getLimitTolerance();},endPos:function(){return this.startPos+this.rows.length;},isNearingBottomLimit:function(_18e){return this.endPos()-(_18e+this.metaData.getPageSize())<this.metaData.getLimitTolerance();},isAtTop:function(){return this.startPos==0;},isAtBottom:function(){return this.endPos()==this.metaData.getTotalRows();},isNearingLimit:function(_18f){return (!this.isAtTop()&&this.isNearingTopLimit(_18f))||(!this.isAtBottom()&&this.isNearingBottomLimit(_18f));},getFetchSize:function(_190){var _191=this.getFetchOffset(_190);var _192=0;if(_191>=this.startPos){var _193=this.maxFetchSize+_191;if(_193>this.metaData.totalRows){_193=this.metaData.totalRows;}_192=_193-_191;if(_191==0&&_192<this.maxFetchSize){_192=this.maxFetchSize;}}else{var _194=this.startPos-_191;if(_194>this.maxFetchSize){_194=this.maxFetchSize;}}return _194;},getFetchOffset:function(_195){var _196=_195;if(_195>this.startPos){_196=(_195>this.endPos())?_195:this.endPos();}else{if(_195+this.maxFetchSize>=this.startPos){var _197=this.startPos-this.maxFetchSize;if(_197<0){_197=0;}}}this.lastOffset=_197;return _197;},getRows:function(_198,_199){var _19a=_198-this.startPos;var _19b=_19a+_199;if(_19b>this.size){_19b=this.size;}var _19c=new Array();var _19d=0;for(var i=_19a;i<_19b;i++){_19c[_19d++]=this.rows[i];}return _19c;},convertSpaces:function(s){return s.split(" ").join("&nbsp;");}};Rico.GridViewPort=Class.create();Rico.GridViewPort.prototype={initialize:function(_1a0,_1a1,_1a2,_1a3,_1a4){this.lastDisplayedStartPos=0;this.div=_1a0.parentNode;this.table=_1a0;this.rowHeight=_1a1;this.div.style.height=(this.rowHeight*_1a2)+"px";this.div.style.overflow="hidden";this.buffer=_1a3;this.liveGrid=_1a4;this.visibleRows=_1a2+1;this.lastPixelOffset=0;this.startPos=0;},populateRow:function(_1a5,row){for(var j=0;j<row.length;j++){_1a5.cells[j].innerHTML=row[j];}},bufferChanged:function(){this.refreshContents(parseInt(this.lastPixelOffset/this.rowHeight));},clearRows:function(){if(!this.isBlank){this.liveGrid.table.className=this.liveGrid.options.loadingClass;for(var i=0;i<this.visibleRows;i++){this.populateRow(this.table.rows[i],this.buffer.getBlankRow());}this.isBlank=true;}},clearContents:function(){this.clearRows();this.scrollTo(0);this.startPos=0;this.lastStartPos=-1;},refreshContents:function(_1a9){if(_1a9==this.lastRowPos&&!this.isPartialBlank&&!this.isBlank){return;}if((_1a9+this.visibleRows<this.buffer.startPos)||(this.buffer.startPos+this.buffer.size<_1a9)||(this.buffer.size==0)){this.clearRows();return;}this.isBlank=false;var _1aa=this.buffer.startPos>_1a9;var _1ab=_1aa?this.buffer.startPos:_1a9;var _1ac=(this.buffer.startPos+this.buffer.size<_1a9+this.visibleRows)?this.buffer.startPos+this.buffer.size:_1a9+this.visibleRows;var _1ad=_1ac-_1ab;var rows=this.buffer.getRows(_1ab,_1ad);var _1af=this.visibleRows-_1ad;var _1b0=_1aa?0:_1ad;var _1b1=_1aa?_1af:0;for(var i=0;i<rows.length;i++){this.populateRow(this.table.rows[i+_1b1],rows[i]);}for(var i=0;i<_1af;i++){this.populateRow(this.table.rows[i+_1b0],this.buffer.getBlankRow());}this.isPartialBlank=_1af>0;this.lastRowPos=_1a9;this.liveGrid.table.className=this.liveGrid.options.tableClass;var _1b4=this.liveGrid.options.onRefreshComplete;if(_1b4!=null){_1b4();}},scrollTo:function(_1b5){if(this.lastPixelOffset==_1b5){return;}this.refreshContents(parseInt(_1b5/this.rowHeight));this.div.scrollTop=_1b5%this.rowHeight;this.lastPixelOffset=_1b5;},visibleHeight:function(){return parseInt(RicoUtil.getElementsComputedStyle(this.div,"height"));}};Rico.LiveGridRequest=Class.create();Rico.LiveGridRequest.prototype={initialize:function(_1b6,_1b7){this.requestOffset=_1b6;}};Rico.LiveGrid=Class.create();Rico.LiveGrid.prototype={initialize:function(_1b8,_1b9,_1ba,url,_1bc,_1bd){this.options={tableClass:$(_1b8).className,loadingClass:$(_1b8).className,scrollerBorderRight:"1px solid #ababab",bufferTimeout:20000,sortAscendImg:"images/sort_asc.gif",sortDescendImg:"images/sort_desc.gif",sortImageWidth:9,sortImageHeight:5,ajaxSortURLParms:[],onRefreshComplete:null,requestParameters:null,inlineStyles:true};Object.extend(this.options,_1bc||{});this.ajaxOptions={parameters:null};Object.extend(this.ajaxOptions,_1bd||{});this.tableId=_1b8;this.table=$(_1b8);this.addLiveGridHtml();var _1be=this.table.rows[0].cells.length;this.metaData=new Rico.LiveGridMetaData(_1b9,_1ba,_1be,_1bc);this.buffer=new Rico.LiveGridBuffer(this.metaData);var _1bf=this.table.rows.length;this.viewPort=new Rico.GridViewPort(this.table,this.table.offsetHeight/_1bf,_1b9,this.buffer,this);this.scroller=new Rico.LiveGridScroller(this,this.viewPort);this.options.sortHandler=this.sortHandler.bind(this);if($(_1b8+"_header")){this.sort=new Rico.LiveGridSort(_1b8+"_header",this.options);}this.processingRequest=null;this.unprocessedRequest=null;this.initAjax(url);if(this.options.prefetchBuffer||this.options.prefetchOffset>0){var _1c0=0;if(this.options.offset){_1c0=this.options.offset;this.scroller.moveScroll(_1c0);this.viewPort.scrollTo(this.scroller.rowToPixel(_1c0));}if(this.options.sortCol){this.sortCol=_1bc.sortCol;this.sortDir=_1bc.sortDir;}this.requestContentRefresh(_1c0);}},addLiveGridHtml:function(){if(this.table.getElementsByTagName("thead").length>0){var _1c1=this.table.cloneNode(true);_1c1.setAttribute("id",this.tableId+"_header");_1c1.setAttribute("class",this.table.className+"_header");for(var i=0;i<_1c1.tBodies.length;i++){_1c1.removeChild(_1c1.tBodies[i]);}this.table.deleteTHead();this.table.parentNode.insertBefore(_1c1,this.table);}new Insertion.Before(this.table,"<div id='"+this.tableId+"_container'></div>");this.table.previousSibling.appendChild(this.table);new Insertion.Before(this.table,"<div id='"+this.tableId+"_viewport' style='float:left;'></div>");this.table.previousSibling.appendChild(this.table);},resetContents:function(){this.scroller.moveScroll(0);this.buffer.clear();this.viewPort.clearContents();},sortHandler:function(_1c3){if(!_1c3){return;}this.sortCol=_1c3.name;this.sortDir=_1c3.currentSort;this.resetContents();this.requestContentRefresh(0);},adjustRowSize:function(){},setTotalRows:function(_1c4){this.resetContents();this.metaData.setTotalRows(_1c4);this.scroller.updateSize();},initAjax:function(url){ajaxEngine.registerRequest(this.tableId+"_request",url);ajaxEngine.registerAjaxObject(this.tableId+"_updater",this);},invokeAjax:function(){},handleTimedOut:function(){this.processingRequest=null;this.processQueuedRequest();},fetchBuffer:function(_1c6){if(this.buffer.isInRange(_1c6)&&!this.buffer.isNearingLimit(_1c6)){return;}if(this.processingRequest){this.unprocessedRequest=new Rico.LiveGridRequest(_1c6);return;}var _1c7=this.buffer.getFetchOffset(_1c6);this.processingRequest=new Rico.LiveGridRequest(_1c6);this.processingRequest.bufferOffset=_1c7;var _1c8=this.buffer.getFetchSize(_1c6);var _1c9=false;var _1ca;if(this.options.requestParameters){_1ca=this._createQueryString(this.options.requestParameters,0);}_1ca=(_1ca==null)?"":_1ca+"&";_1ca=_1ca+"id="+this.tableId+"&page_size="+_1c8+"&offset="+_1c7;if(this.sortCol){_1ca=_1ca+"&sort_col="+escape(this.sortCol)+"&sort_dir="+this.sortDir;}this.ajaxOptions.parameters=_1ca;ajaxEngine.sendRequest(this.tableId+"_request",this.ajaxOptions);this.timeoutHandler=setTimeout(this.handleTimedOut.bind(this),this.options.bufferTimeout);},setRequestParams:function(){this.options.requestParameters=[];for(var i=0;i<arguments.length;i++){this.options.requestParameters[i]=arguments[i];}},requestContentRefresh:function(_1cc){this.fetchBuffer(_1cc);},ajaxUpdate:function(_1cd){try{clearTimeout(this.timeoutHandler);this.buffer.update(_1cd,this.processingRequest.bufferOffset);this.viewPort.bufferChanged();}catch(err){}finally{this.processingRequest=null;}this.processQueuedRequest();},_createQueryString:function(_1ce,_1cf){var _1d0="";if(!_1ce){return _1d0;}for(var i=_1cf;i<_1ce.length;i++){if(i!=_1cf){_1d0+="&";}var _1d2=_1ce[i];if(_1d2.name!=undefined&&_1d2.value!=undefined){_1d0+=_1d2.name+"="+escape(_1d2.value);}else{var ePos=_1d2.indexOf("=");var _1d4=_1d2.substring(0,ePos);var _1d5=_1d2.substring(ePos+1);_1d0+=_1d4+"="+escape(_1d5);}}return _1d0;},processQueuedRequest:function(){if(this.unprocessedRequest!=null){this.requestContentRefresh(this.unprocessedRequest.requestOffset);this.unprocessedRequest=null;}}};Rico.LiveGridSort=Class.create();Rico.LiveGridSort.prototype={initialize:function(_1d6,_1d7){this.headerTableId=_1d6;this.headerTable=$(_1d6);this.options=_1d7;this.setOptions();this.applySortBehavior();if(this.options.sortCol){this.setSortUI(this.options.sortCol,this.options.sortDir);}},setSortUI:function(_1d8,_1d9){var cols=this.options.columns;for(var i=0;i<cols.length;i++){if(cols[i].name==_1d8){this.setColumnSort(i,_1d9);break;}}},setOptions:function(){new Image().src=this.options.sortAscendImg;new Image().src=this.options.sortDescendImg;this.sort=this.options.sortHandler;if(!this.options.columns){this.options.columns=this.introspectForColumnInfo();}else{this.options.columns=this.convertToTableColumns(this.options.columns);}},applySortBehavior:function(){var _1dc=this.headerTable.rows[0];var _1dd=_1dc.cells;for(var i=0;i<_1dd.length;i++){this.addSortBehaviorToColumn(i,_1dd[i]);}},addSortBehaviorToColumn:function(n,cell){if(this.options.columns[n].isSortable()){cell.id=this.headerTableId+"_"+n;cell.style.cursor="pointer";cell.onclick=this.headerCellClicked.bindAsEventListener(this);cell.innerHTML=cell.innerHTML+"<span id=\""+this.headerTableId+"_img_"+n+"\">"+"&nbsp;&nbsp;&nbsp;</span>";}},headerCellClicked:function(evt){var _1e2=evt.target?evt.target:evt.srcElement;var _1e3=_1e2.id;var _1e4=parseInt(_1e3.substring(_1e3.lastIndexOf("_")+1));var _1e5=this.getSortedColumnIndex();if(_1e5!=-1){if(_1e5!=_1e4){this.removeColumnSort(_1e5);this.setColumnSort(_1e4,Rico.TableColumn.SORT_ASC);}else{this.toggleColumnSort(_1e5);}}else{this.setColumnSort(_1e4,Rico.TableColumn.SORT_ASC);}if(this.options.sortHandler){this.options.sortHandler(this.options.columns[_1e4]);}},removeColumnSort:function(n){this.options.columns[n].setUnsorted();this.setSortImage(n);},setColumnSort:function(n,_1e8){if(isNaN(n)){return;}this.options.columns[n].setSorted(_1e8);this.setSortImage(n);},toggleColumnSort:function(n){this.options.columns[n].toggleSort();this.setSortImage(n);},setSortImage:function(n){var _1eb=this.options.columns[n].getSortDirection();var _1ec=$(this.headerTableId+"_img_"+n);if(_1eb==Rico.TableColumn.UNSORTED){_1ec.innerHTML="&nbsp;&nbsp;";}else{if(_1eb==Rico.TableColumn.SORT_ASC){_1ec.innerHTML="&nbsp;&nbsp;<img width=\""+this.options.sortImageWidth+"\" "+"height=\""+this.options.sortImageHeight+"\" "+"src=\""+this.options.sortAscendImg+"\"/>";}else{if(_1eb==Rico.TableColumn.SORT_DESC){_1ec.innerHTML="&nbsp;&nbsp;<img width=\""+this.options.sortImageWidth+"\" "+"height=\""+this.options.sortImageHeight+"\" "+"src=\""+this.options.sortDescendImg+"\"/>";}}}},getSortedColumnIndex:function(){var cols=this.options.columns;for(var i=0;i<cols.length;i++){if(cols[i].isSorted()){return i;}}return -1;},introspectForColumnInfo:function(){var _1ef=new Array();var _1f0=this.headerTable.rows[0];var _1f1=_1f0.cells;for(var i=0;i<_1f1.length;i++){_1ef.push(new Rico.TableColumn(this.deriveColumnNameFromCell(_1f1[i],i),true));}return _1ef;},convertToTableColumns:function(cols){var _1f4=new Array();for(var i=0;i<cols.length;i++){_1f4.push(new Rico.TableColumn(cols[i][0],cols[i][1]));}return _1f4;},deriveColumnNameFromCell:function(cell,_1f7){var _1f8=cell.innerText!=undefined?cell.innerText:cell.textContent;return _1f8?_1f8.toLowerCase().split(" ").join("_"):"col_"+_1f7;}};Rico.TableColumn=Class.create();Rico.TableColumn.UNSORTED=0;Rico.TableColumn.SORT_ASC="ASC";Rico.TableColumn.SORT_DESC="DESC";Rico.TableColumn.prototype={initialize:function(name,_1fa){this.name=name;this.sortable=_1fa;this.currentSort=Rico.TableColumn.UNSORTED;},isSortable:function(){return this.sortable;},isSorted:function(){return this.currentSort!=Rico.TableColumn.UNSORTED;},getSortDirection:function(){return this.currentSort;},toggleSort:function(){if(this.currentSort==Rico.TableColumn.UNSORTED||this.currentSort==Rico.TableColumn.SORT_DESC){this.currentSort=Rico.TableColumn.SORT_ASC;}else{if(this.currentSort==Rico.TableColumn.SORT_ASC){this.currentSort=Rico.TableColumn.SORT_DESC;}}},setUnsorted:function(_1fb){this.setSorted(Rico.TableColumn.UNSORTED);},setSorted:function(_1fc){this.currentSort=_1fc;}};var RicoUtil={getElementsComputedStyle:function(_1fd,_1fe,_1ff){if(arguments.length==2){_1ff=_1fe;}var el=$(_1fd);if(el.currentStyle){return el.currentStyle[_1fe];}else{return document.defaultView.getComputedStyle(el,null).getPropertyValue(_1ff);}},createXmlDocument:function(){if(document.implementation&&document.implementation.createDocument){var doc=document.implementation.createDocument("","",null);if(doc.readyState==null){doc.readyState=1;doc.addEventListener("load",function(){doc.readyState=4;if(typeof doc.onreadystatechange=="function"){doc.onreadystatechange();}},false);}return doc;}if(window.ActiveXObject){return Try.these(function(){return new ActiveXObject("MSXML2.DomDocument");},function(){return new ActiveXObject("Microsoft.DomDocument");},function(){return new ActiveXObject("MSXML.DomDocument");},function(){return new ActiveXObject("MSXML3.DomDocument");})||false;}return null;},getContentAsString:function(_202){return _202.xml!=undefined?this._getContentAsStringIE(_202):this._getContentAsStringMozilla(_202);},_getContentAsStringIE:function(_203){var _204="";for(var i=0;i<_203.childNodes.length;i++){var n=_203.childNodes[i];if(n.nodeType==4){_204+=n.nodeValue;}else{_204+=n.xml;}}return _204;},_getContentAsStringMozilla:function(_207){var _208=new XMLSerializer();var _209="";for(var i=0;i<_207.childNodes.length;i++){var n=_207.childNodes[i];if(n.nodeType==4){_209+=n.nodeValue;}else{_209+=_208.serializeToString(n);}}return _209;},toViewportPosition:function(_20c){return this._toAbsolute(_20c,true);},toDocumentPosition:function(_20d){return this._toAbsolute(_20d,false);},_toAbsolute:function(_20e,_20f){if(navigator.userAgent.toLowerCase().indexOf("msie")==-1){return this._toAbsoluteMozilla(_20e,_20f);}var x=0;var y=0;var _212=_20e;while(_212){var _213=0;var _214=0;if(_212!=_20e){var _215=parseInt(this.getElementsComputedStyle(_212,"borderLeftWidth"));var _216=parseInt(this.getElementsComputedStyle(_212,"borderTopWidth"));_215=isNaN(_215)?0:_215;_216=isNaN(_216)?0:_216;}x+=_212.offsetLeft-_212.scrollLeft+_215;y+=_212.offsetTop-_212.scrollTop+_216;_212=_212.offsetParent;}if(_20f){x-=this.docScrollLeft();y-=this.docScrollTop();}return {x:x,y:y};},_toAbsoluteMozilla:function(_217,_218){var x=0;var y=0;var _21b=_217;while(_21b){x+=_21b.offsetLeft;y+=_21b.offsetTop;_21b=_21b.offsetParent;}_21b=_217;while(_21b&&_21b!=document.body&&_21b!=document.documentElement){if(_21b.scrollLeft){x-=_21b.scrollLeft;}if(_21b.scrollTop){y-=_21b.scrollTop;}_21b=_21b.parentNode;}if(_218){x-=this.docScrollLeft();y-=this.docScrollTop();}return {x:x,y:y};},docScrollLeft:function(){if(window.pageXOffset){return window.pageXOffset;}else{if(document.documentElement&&document.documentElement.scrollLeft){return document.documentElement.scrollLeft;}else{if(document.body){return document.body.scrollLeft;}else{return 0;}}}},docScrollTop:function(){if(window.pageYOffset){return window.pageYOffset;}else{if(document.documentElement&&document.documentElement.scrollTop){return document.documentElement.scrollTop;}else{if(document.body){return document.body.scrollTop;}else{return 0;}}}}};